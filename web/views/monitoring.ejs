<%- include('partials/header') %>

<%
  var level = typeof accessLevel !== 'undefined' ? accessLevel : 'public';
  var isOwner = level === 'owner';
  var isAdmin = level === 'owner' || level === 'admin';
  var isMember = level !== 'public';
%>

<div class="st-page">

  <!-- Hero header -->
  <div class="st-hero">
    <div class="st-hero-glow"></div>
    <div class="st-hero-content">
      <div class="st-hero-left">
        <div class="st-hero-ring" id="st-health-ring">
          <svg viewBox="0 0 120 120" class="st-ring-svg">
            <circle cx="60" cy="60" r="52" class="st-ring-track"/>
            <circle cx="60" cy="60" r="52" class="st-ring-fill" id="st-uptime-ring"
                    stroke-dasharray="326.7" stroke-dashoffset="326.7"/>
          </svg>
          <div class="st-ring-inner">
            <span class="st-ring-icon" id="st-health-icon">â³</span>
            <span class="st-ring-label" id="st-health-text">Connexionâ€¦</span>
          </div>
        </div>
        <div class="st-hero-info">
          <h1 class="st-hero-title" data-i18n="mon.title">System Status</h1>
          <p class="st-hero-sub" data-i18n="mon.subtitle">Surveillance en temps rÃ©el du bot â€” MÃ©triques systÃ¨me, Discord et jeu</p>
          <div class="st-hero-chips">
            <% if (isMember) { %>
              <span class="access-badge access-<%= level %>" data-i18n="mon.access_<%= level %>"><%= level === 'owner' ? 'ğŸ‘‘ Owner' : level === 'admin' ? 'ğŸ›¡ï¸ Admin' : 'ğŸ‘¤ Member' %></span>
            <% } %>
            <span class="st-chip st-chip--auto" id="st-auto-chip">
              <span class="st-chip-dot"></span>
              <span data-i18n="mon.auto_refresh">Auto-refresh 30s</span>
            </span>
            <button class="st-chip st-chip--btn" id="mon-refresh-btn">
              â†» <span data-i18n="mon.refresh">Actualiser</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Top KPI strip -->
  <div class="st-kpi-strip">
    <div class="st-kpi" data-color="green">
      <div class="st-kpi-icon">âš¡</div>
      <div class="st-kpi-body">
        <span class="st-kpi-value" id="mon-uptime">â€”</span>
        <span class="st-kpi-label" data-i18n="mon.uptime">Uptime</span>
      </div>
    </div>
    <div class="st-kpi" data-color="blue">
      <div class="st-kpi-icon">ğŸ“¡</div>
      <div class="st-kpi-body">
        <span class="st-kpi-value" id="mon-latency">â€”</span>
        <span class="st-kpi-label" data-i18n="mon.latency">Latence Discord</span>
      </div>
    </div>
    <div class="st-kpi" data-color="violet">
      <div class="st-kpi-icon">ğŸ®</div>
      <div class="st-kpi-body">
        <span class="st-kpi-value" id="mon-gm-active">â€”</span>
        <span class="st-kpi-label" data-i18n="mon.active_games">Parties actives</span>
      </div>
    </div>
    <div class="st-kpi" data-color="amber">
      <div class="st-kpi-icon">ğŸ‘¥</div>
      <div class="st-kpi-body">
        <span class="st-kpi-value" id="mon-gm-players">â€”</span>
        <span class="st-kpi-label" data-i18n="mon.total_players">Joueurs en jeu</span>
      </div>
    </div>
    <% if (isAdmin) { %>
    <div class="st-kpi" data-color="rose">
      <div class="st-kpi-icon">ğŸ’¾</div>
      <div class="st-kpi-body">
        <span class="st-kpi-value" id="mon-memory">â€”</span>
        <span class="st-kpi-label" data-i18n="mon.memory">MÃ©moire (RSS)</span>
      </div>
    </div>
    <% } %>
  </div>

  <!-- Panel grid -->
  <div class="st-grid">

    <% if (isOwner) { %>
    <!-- Latency sparkline chart -->
    <div class="st-panel st-panel--wide st-panel--chart st-panel--collapsed">
      <div class="st-panel-head">
        <h3 class="st-panel-title">ğŸ“ˆ <span data-i18n="mon.latency_chart">Latence Discord (24h)</span></h3>
        <div class="st-panel-head-right">
          <span class="st-panel-badge" id="st-lat-avg">â€” ms avg</span>
          <div class="st-chart-toggle" role="button" tabindex="0" aria-label="Expand chart" data-i18n-aria-label="mon.aria_expand_chart" title="Expand" data-i18n-title="mon.title_expand">
            <span class="st-chart-chevron"></span>
          </div>
        </div>
      </div>
      <div class="st-chart-body">
        <div class="st-chart-wrap">
          <canvas id="st-chart-latency" height="180"></canvas>
          <div class="st-chart-crosshair"></div>
          <div class="st-chart-tooltip">
            <span class="st-chart-tooltip-time"></span>
            <span class="st-chart-tooltip-val"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Memory sparkline chart -->
    <div class="st-panel st-panel--wide st-panel--chart st-panel--collapsed">
      <div class="st-panel-head">
        <h3 class="st-panel-title">ğŸ“Š <span data-i18n="mon.memory_chart">MÃ©moire (24h)</span></h3>
        <div class="st-panel-head-right">
          <span class="st-panel-badge st-badge--mem" id="st-mem-avg">â€” MB avg</span>
          <div class="st-chart-toggle" role="button" tabindex="0" aria-label="Expand chart" data-i18n-aria-label="mon.aria_expand_chart" title="Expand" data-i18n-title="mon.title_expand">
            <span class="st-chart-chevron"></span>
          </div>
        </div>
      </div>
      <div class="st-chart-body">
        <div class="st-chart-wrap">
          <canvas id="st-chart-memory" height="180"></canvas>
          <div class="st-chart-crosshair"></div>
          <div class="st-chart-tooltip">
            <span class="st-chart-tooltip-time"></span>
            <span class="st-chart-tooltip-val"></span>
          </div>
        </div>
      </div>
    </div>
    <% } %>

    <% if (isOwner) { %>
    <!-- System panel -->
    <div class="st-panel">
      <div class="st-panel-head">
        <h3 class="st-panel-title">ğŸ–¥ï¸ <span data-i18n="mon.system">SystÃ¨me</span></h3>
      </div>
      <div class="st-metrics">
        <div class="st-row"><span class="st-label" data-i18n="mon.memory">MÃ©moire (RSS)</span><span class="st-val" id="mon-sys-rss">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.heap">Heap V8</span><span class="st-val" id="mon-sys-heap">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.cpu">CPU</span><span class="st-val" id="mon-sys-cpu">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.ram_free">RAM libre</span><span class="st-val" id="mon-sys-ram-free">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.ram_total">RAM totale</span><span class="st-val" id="mon-sys-ram-total">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.process_uptime">Uptime process</span><span class="st-val" id="mon-sys-uptime">â€”</span></div>
      </div>
      <div class="st-bar-group">
        <div class="st-bar-label">RAM <span id="st-mem-pct">0%</span></div>
        <div class="st-bar-track"><div class="st-bar-fill" id="mon-mem-bar"></div></div>
      </div>
    </div>
    <% } %>

    <% if (isAdmin) { %>
    <!-- Discord panel -->
    <div class="st-panel">
      <div class="st-panel-head">
        <h3 class="st-panel-title">ğŸ¤– <span data-i18n="mon.discord">Discord</span></h3>
      </div>
      <div class="st-metrics">
        <div class="st-row"><span class="st-label" data-i18n="mon.guilds">Serveurs</span><span class="st-val" id="mon-dc-guilds">â€”</span></div>
        <% if (isOwner) { %>
        <div class="st-row"><span class="st-label" data-i18n="mon.users_cached">Utilisateurs</span><span class="st-val" id="mon-dc-users">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.channels">Channels</span><span class="st-val" id="mon-dc-channels">â€”</span></div>
        <% } %>
        <div class="st-row"><span class="st-label" data-i18n="mon.ws_status">Statut WS</span><span class="st-val" id="mon-dc-ws-status">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.ws_latency">Latence WS</span><span class="st-val" id="mon-dc-latency">â€”</span></div>
      </div>
      <div class="st-bar-group">
        <div class="st-bar-label">Latency <span id="st-lat-pct">0ms</span></div>
        <div class="st-bar-track"><div class="st-bar-fill st-bar--blue" id="mon-latency-bar"></div></div>
      </div>
    </div>
    <% } %>

    <!-- Game panel (all levels) -->
    <div class="st-panel">
      <div class="st-panel-head">
        <h3 class="st-panel-title">ğŸ² <span data-i18n="mon.game">Jeu</span></h3>
      </div>
      <div class="st-metrics">
        <div class="st-row"><span class="st-label" data-i18n="mon.active_games">Parties actives</span><span class="st-val" id="mon-gm-active2">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.total_players">Joueurs en jeu</span><span class="st-val" id="mon-gm-players2">â€”</span></div>
        <% if (isAdmin) { %>
        <div class="st-row"><span class="st-label" data-i18n="mon.games_24h">Parties (24h)</span><span class="st-val" id="mon-gm-created24">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.completed_24h">TerminÃ©es (24h)</span><span class="st-val" id="mon-gm-completed24">â€”</span></div>
        <% } %>
      </div>
    </div>

    <% if (isOwner) { %>
    <!-- Commands panel -->
    <div class="st-panel">
      <div class="st-panel-head">
        <h3 class="st-panel-title">âš¡ <span data-i18n="mon.commands">Commandes</span></h3>
      </div>
      <div class="st-metrics">
        <div class="st-row"><span class="st-label" data-i18n="mon.cmd_total">Total exÃ©cutÃ©es</span><span class="st-val" id="mon-cmd-total">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.cmd_errors">Erreurs</span><span class="st-val st-val--danger" id="mon-cmd-errors">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.cmd_ratelimited">Rate limited</span><span class="st-val st-val--warn" id="mon-cmd-rl">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.cmd_avg">Temps moyen</span><span class="st-val" id="mon-cmd-avg">â€”</span></div>
      </div>
    </div>

    <!-- Errors panel -->
    <div class="st-panel">
      <div class="st-panel-head">
        <h3 class="st-panel-title">âš ï¸ <span data-i18n="mon.errors">Erreurs</span></h3>
      </div>
      <div class="st-metrics">
        <div class="st-row"><span class="st-label" data-i18n="mon.err_total">Total</span><span class="st-val" id="mon-err-total">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.err_critical">Critiques</span><span class="st-val st-val--danger" id="mon-err-critical">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.err_warnings">Avertissements</span><span class="st-val st-val--warn" id="mon-err-warnings">â€”</span></div>
        <div class="st-row"><span class="st-label" data-i18n="mon.err_24h">DerniÃ¨res 24h</span><span class="st-val" id="mon-err-24h">â€”</span></div>
      </div>
    </div>
    <% } %>

    <% if (!isMember) { %>
    <!-- Login prompt -->
    <div class="st-panel st-panel--wide st-panel--locked">
      <div class="st-locked-content">
        <span class="st-locked-icon">ğŸ”’</span>
        <h3 data-i18n="mon.login_required">Connectez-vous pour voir plus de dÃ©tails</h3>
        <p data-i18n="mon.login_desc">Les mÃ©triques dÃ©taillÃ©es sont rÃ©servÃ©es aux membres connectÃ©s et administrateurs.</p>
        <a href="/auth/discord" class="btn btn-discord">
          <svg width="16" height="16" viewBox="0 -28.5 256 256" fill="currentColor"><path d="M216.856 16.597A208.502 208.502 0 00164.042 0c-2.275 4.113-4.933 9.645-6.766 14.046-19.692-2.961-39.203-2.961-58.533 0-1.832-4.4-4.55-9.933-6.846-14.046a207.809 207.809 0 00-52.855 16.638C5.618 67.147-3.443 116.4 1.087 164.956c22.169 16.555 43.653 26.612 64.775 33.193a161.094 161.094 0 0013.96-22.765 136.2 136.2 0 01-21.958-10.632c1.839-1.36 3.637-2.78 5.38-4.252 42.371 19.702 88.344 19.702 130.169 0 1.764 1.472 3.562 2.893 5.38 4.252-6.992 4.2-14.4 7.7-21.998 10.652 3.832 7.533 8.408 14.792 13.981 22.745 21.142-6.58 42.646-16.637 64.815-33.213 5.316-56.288-9.08-105.09-38.056-148.36zM85.474 135.095c-12.645 0-23.015-11.805-23.015-26.18s10.149-26.2 23.015-26.2c12.867 0 23.236 11.823 23.015 26.2.02 14.375-10.148 26.18-23.015 26.18zm85.051 0c-12.645 0-23.014-11.805-23.014-26.18s10.148-26.2 23.014-26.2c12.867 0 23.236 11.823 23.015 26.2 0 14.375-10.148 26.18-23.015 26.18z"/></svg>
          <span data-i18n="nav.login">Login</span>
        </a>
      </div>
    </div>
    <% } else if (!isOwner && isMember) { %>
    <div class="st-panel st-panel--wide st-panel--locked">
      <div class="st-locked-content">
        <span class="st-locked-icon">ğŸ”’</span>
        <p data-i18n="mon.restricted_notice">Certaines mÃ©triques avancÃ©es sont rÃ©servÃ©es aux administrateurs du bot.</p>
      </div>
    </div>
    <% } %>

  </div>
</div>

<script>window.__accessLevel = '<%= level %>';</script>
<script src="/static/js/monitoring.js"></script>

<%- include('partials/footer') %>
