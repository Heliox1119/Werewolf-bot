<%- include('partials/header') %>

<!-- Ambient floating orbs -->
<div class="dash-ambient" aria-hidden="true">
  <div class="dash-orb dash-orb-1"></div>
  <div class="dash-orb dash-orb-2"></div>
  <div class="dash-orb dash-orb-3"></div>
</div>

<!-- â•â•â• HERO COMMAND CENTER â•â•â• -->
<section class="dash-hero">
  <div class="dash-hero-bg">
    <div class="dash-hero-gradient"></div>
    <div class="dash-hero-dots"></div>
    <div class="dash-hero-scanline"></div>
  </div>
  <div class="dash-hero-inner">
    <div class="dash-hero-left">
      <div class="dash-hero-avatar-wrap">
        <img src="/static/img/roles/LG.jpg" alt="Werewolf" class="dash-hero-avatar">
        <div class="dash-avatar-ring"></div>
        <div class="dash-avatar-ring dash-avatar-ring-lg"></div>
      </div>
      <div class="dash-hero-info">
        <h1 class="dash-hero-title">Werewolf <span>Dashboard</span></h1>
        <p class="dash-hero-subtitle">Centre de commandement Â· Surveillance temps rÃ©el</p>
        <div class="dash-hero-status">
          <span class="status-beacon"></span>
          <span class="status-text">SystÃ¨me opÃ©rationnel</span>
        </div>
      </div>
    </div>
    <div class="dash-hero-metrics">
      <div class="dash-metric" style="--i:0">
        <div class="dash-metric-icon dm-green">ğŸ®</div>
        <div class="dash-metric-data">
          <span class="dash-metric-val counter" data-target="<%= activeGames %>" id="active-games">0</span>
          <span class="dash-metric-label">Parties actives</span>
        </div>
      </div>
      <div class="dash-metric" style="--i:1">
        <div class="dash-metric-icon dm-blue">ğŸ‘¥</div>
        <div class="dash-metric-data">
          <span class="dash-metric-val counter" data-target="<%= activePlayers %>" id="active-players">0</span>
          <span class="dash-metric-label">Joueurs en jeu</span>
        </div>
      </div>
      <div class="dash-metric" style="--i:2">
        <div class="dash-metric-icon dm-purple">ğŸ°</div>
        <div class="dash-metric-data">
          <span class="dash-metric-val counter" data-target="<%= guilds %>">0</span>
          <span class="dash-metric-label">Serveurs</span>
        </div>
      </div>
      <div class="dash-metric" style="--i:3">
        <div class="dash-metric-icon dm-amber">ğŸ“Š</div>
        <div class="dash-metric-data">
          <span class="dash-metric-val counter" data-target="<%= stats.total_games || 0 %>">0</span>
          <span class="dash-metric-label">Total parties</span>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• MAIN GRID â•â•â• -->
<div class="dashboard-grid">
  <div class="dashboard-main">
    <!-- Live Games Panel -->
    <div class="dash-panel" style="--enter:0">
      <div class="dash-panel-head">
        <div class="dash-panel-title"><span class="pulse-dot"></span> Parties en direct</div>
        <span class="badge-count"><%= games.length %></span>
      </div>
      <div class="games-grid" id="games-grid">
        <% if (games.length === 0) { %>
          <div class="empty-state">
            <div class="empty-visual">
              <span class="empty-icon-lg">ğŸŒ™</span>
              <div class="empty-glow-ring"></div>
            </div>
            <p class="empty-title">Le village dort paisiblement</p>
            <p class="empty-sub text-muted">Les parties apparaÃ®tront ici en temps rÃ©el</p>
          </div>
        <% } else { %>
          <% games.forEach(function(g) {
            var alive = g.players ? g.players.filter(function(p) { return p.alive; }).length : 0;
            var dead = g.dead ? g.dead.length : 0;
            var total = alive + dead;
            var pct = total > 0 ? Math.round(alive / total * 100) : 100;
          %>
            <a href="/game/<%= g.gameId %>" class="game-card" data-game="<%= g.gameId %>">
              <div class="game-card-header">
                <span class="game-phase phase-<%= (g.phase || 'lobby').toLowerCase() %>"><%= g.phase || 'Lobby' %></span>
                <span class="game-day"><%= g.dayCount ? 'Jour ' + g.dayCount : '' %></span>
              </div>
              <div class="game-card-body">
                <div class="game-guild"><%= g.guildName || g.guildId %></div>
                <div class="game-players">
                  <span class="alive-count">â¤ï¸ <%= alive %> vivants</span>
                  <span class="dead-count">â˜ ï¸ <%= dead %> morts</span>
                </div>
                <div class="game-hp-bar">
                  <div class="game-hp-fill" style="width: <%= pct %>%"></div>
                </div>
                <% if (g.subPhase) { %>
                  <div class="game-subphase-tag"><%= g.subPhase %></div>
                <% } %>
              </div>
              <div class="game-card-footer">
                <span class="spectate-btn">ğŸ‘ï¸ Regarder en direct</span>
              </div>
            </a>
          <% }); %>
        <% } %>
      </div>
    </div>

    <!-- Card Deck Draw â€” Wide layout -->
    <div class="dash-panel deck-panel deck-panel-wide" style="--enter:1">
      <div class="dash-panel-head">
        <div class="dash-panel-title">ğŸƒ Piocher un rÃ´le</div>
      </div>
      <div class="deck-wide-layout">
        <div class="deck-wide-left">
          <div class="deck-area">
            <div class="deck-stack" id="deck-stack">
              <div class="deck-card dc-1"></div>
              <div class="deck-card dc-2"></div>
              <div class="deck-card dc-3"></div>
              <div class="deck-card dc-4"></div>
              <div class="deck-card dc-top"></div>
            </div>
            <div class="drawn-card-zone" id="drawn-card-zone">
              <div class="drawn-card" id="drawn-card">
                <div class="drawn-card-inner" id="drawn-card-inner">
                  <div class="drawn-card-front">
                    <img src="/static/img/roles/loup-garou-dos.png" alt="Dos" class="drawn-card-img">
                  </div>
                  <div class="drawn-card-back" id="drawn-card-back">
                    <img src="" alt="" class="drawn-role-img" id="drawn-role-img">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <button class="btn btn-draw" id="btn-draw" type="button">
            <span class="draw-icon">ğŸ´</span> Piocher une carte
          </button>
        </div>
        <div class="deck-wide-right" id="drawn-role-info">
          <div class="drawn-role-placeholder" id="drawn-role-placeholder">
            <span class="drawn-role-placeholder-icon">ğŸ´</span>
            <span class="drawn-role-placeholder-text">Piochez une carte pour dÃ©couvrir un rÃ´le</span>
          </div>
          <div class="drawn-role-detail" id="drawn-role-detail">
            <span class="drawn-role-name" id="drawn-role-name"></span>
            <span class="drawn-role-camp" id="drawn-role-camp"></span>
            <p class="drawn-role-desc" id="drawn-role-desc"></p>
            <span class="drawn-role-cmd" id="drawn-role-cmd"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar -->
  <aside class="dashboard-sidebar">
    <!-- Activity Feed -->
    <div class="sidebar-panel" style="--enter:2">
      <h3 class="panel-title"><span class="pulse-dot"></span> ActivitÃ© rÃ©cente</h3>
      <div class="activity-feed" id="activity-feed">
        <div class="activity-empty text-muted">En attente d'Ã©vÃ©nements...</div>
      </div>
    </div>

    <!-- Quick Links -->
    <div class="sidebar-panel" style="--enter:3">
      <h3 class="panel-title">âš¡ AccÃ¨s rapide</h3>
      <div class="quick-links">
        <a href="/roles" class="quick-link">
          <span class="quick-link-icon">ğŸº</span>
          <div class="quick-link-body">
            <span class="quick-link-title">RÃ´les</span>
            <span class="quick-link-desc">DÃ©couvrir tous les rÃ´les du jeu</span>
          </div>
          <span class="quick-link-arrow">â€º</span>
        </a>
        <a href="https://github.com/Heliox1119/Werewolf-bot" target="_blank" class="quick-link">
          <span class="quick-link-icon">ğŸ’»</span>
          <div class="quick-link-body">
            <span class="quick-link-title">GitHub</span>
            <span class="quick-link-desc">Code source du bot</span>
          </div>
          <span class="quick-link-arrow">â€º</span>
        </a>
      </div>
    </div>
  </aside>
</div>

<script src="/static/js/dashboard.js"></script>
<%- include('partials/footer') %>
