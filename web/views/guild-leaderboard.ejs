<%- include('partials/header') %>

<!-- â•â•â• HERO â•â•â• -->
<section class="gl-hero">
  <div class="gl-hero-bg">
    <div class="gl-hero-gradient"></div>
    <div class="gl-hero-dots"></div>
    <div class="gl-hero-scanline"></div>
  </div>
  <div class="gl-hero-inner">
    <div class="gl-hero-left">
      <div class="gl-hero-avatar-wrap">
        <% if (guild && guild.icon) { %>
          <img src="<%= guild.icon %>" alt="<%= guild.name %>" class="gl-hero-avatar">
        <% } else { %>
          <div class="gl-hero-avatar gl-hero-avatar-placeholder">ğŸ†</div>
        <% } %>
        <div class="gl-avatar-ring"></div>
        <div class="gl-avatar-ring gl-avatar-ring-lg"></div>
      </div>
      <div class="gl-hero-info">
        <h1 class="gl-hero-title"><%= guild ? guild.name : 'Guild ' + guildId %></h1>
        <p class="gl-hero-subtitle" data-i18n="gleader.subtitle">Classement &middot; Points &amp; Performances</p>
        <div class="gl-hero-tags">
          <div class="gl-hero-tag gl-tag-players">
            <span>ğŸ†</span> <%= leaderboard.length %> joueurs classÃ©s
          </div>
          <% if (guild && guild.memberCount) { %>
            <div class="gl-hero-tag gl-tag-members">
              <span>ğŸ‘¥</span> <%= guild.memberCount %> membres
            </div>
          <% } %>
          <% if (leaderboard.length > 0) { %>
            <div class="gl-hero-tag gl-tag-top">
              <span>ğŸ‘‘</span> Meilleur score : <%= leaderboard[0].elo_rating || 1000 %> pts
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</section>

<% if (leaderboard.length === 0) { %>
  <div class="gl-empty">
    <div class="gl-empty-icon">ğŸ†</div>
    <p data-i18n="gleader.empty">Aucun joueur classÃ© pour le moment. Jouez des parties pour voir le classement !</p>
  </div>
<% } else { %>

  <% var medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰']; %>

  <!-- â•â•â• PODIUM â•â•â• -->
  <% if (leaderboard.length >= 3) { %>
  <section class="gl-podium-section">
    <div class="gl-podium">
      <% var podiumOrder = [1, 0, 2]; %>
      <% podiumOrder.forEach(function(idx) { var p = leaderboard[idx]; if (!p) return; var wr = p.games_played > 0 ? Math.round((p.games_won / p.games_played) * 100) : 0; %>
        <div class="gl-podium-card gl-podium-<%= idx + 1 %>" style="--i:<%= idx %>">
          <div class="gl-podium-glow"></div>
          <div class="gl-podium-medal"><%- medals[idx] %></div>
          <div class="gl-podium-rank">#<%= p.rank %></div>
          <a href="/player/<%= p.player_id %>" class="gl-podium-name"><%= p.username || p.player_id %></a>
          <div class="gl-podium-elo">
            <span class="gl-elo-val"><%= p.elo_rating || 1000 %></span>
            <span class="gl-elo-label">Points</span>
          </div>
          <div class="gl-podium-tier"><%= (p.tier || {}).emoji || '' %> <%= (p.tier || {}).name || '' %></div>
          <div class="gl-podium-bar">
            <div class="gl-podium-bar-fill" style="width:<%= wr %>%"></div>
          </div>
          <div class="gl-podium-stats">
            <div class="gl-podium-stat">
              <span class="gl-podium-stat-val"><%= p.games_won || 0 %></span>
              <span class="gl-podium-stat-label">Victoires</span>
            </div>
            <div class="gl-podium-stat">
              <span class="gl-podium-stat-val"><%= p.games_played || 0 %></span>
              <span class="gl-podium-stat-label">Games</span>
            </div>
            <div class="gl-podium-stat">
              <span class="gl-podium-stat-val"><%= wr %>%</span>
              <span class="gl-podium-stat-label">Win%</span>
            </div>
          </div>
        </div>
      <% }); %>
    </div>
  </section>
  <% } %>

  <!-- â•â•â• FULL TABLE â•â•â• -->
  <section class="gl-table-panel" style="animation: panelEnter 0.5s ease-out both; animation-delay: 0.35s;">
    <div class="gl-table-header">
      <h2 class="gl-table-title">ğŸ“‹ <span data-i18n="gleader.full_ranking">Classement complet</span></h2>
      <span class="gl-table-count"><%= leaderboard.length %> joueurs</span>
    </div>
    <div class="gl-table-wrap">
      <table class="gl-table">
        <thead>
          <tr>
            <th class="gl-th-rank">#</th>
            <th class="gl-th-player" data-i18n="gleader.col_player">Joueur</th>
            <th class="gl-th-elo">Points</th>
            <th class="gl-th-tier" data-i18n="gleader.col_tier">Rang</th>
            <th data-i18n="gleader.col_games">Parties</th>
            <th data-i18n="gleader.col_wins">Victoires</th>
            <th data-i18n="gleader.col_winrate">Win%</th>
            <th data-i18n="gleader.col_wolf_wins">ğŸº Loups</th>
            <th data-i18n="gleader.col_village_wins">ğŸ¡ Village</th>
            <th data-i18n="gleader.col_streak">SÃ©rie</th>
          </tr>
        </thead>
        <tbody>
          <% leaderboard.forEach(function(p, i) { %>
            <% var wr = p.games_played > 0 ? Math.round((p.games_won / p.games_played) * 100) : 0; %>
            <tr class="gl-row<%= p.rank <= 3 ? ' gl-row-top gl-row-' + p.rank : '' %>" style="animation-delay:<%= 0.4 + i * 0.03 %>s">
              <td class="gl-cell-rank">
                <% if (p.rank <= 3) { %>
                  <span class="gl-rank-badge gl-rank-<%= p.rank %>"><%- medals[p.rank - 1] %></span>
                <% } else { %>
                  <span class="gl-rank-num"><%= p.rank %></span>
                <% } %>
              </td>
              <td class="gl-cell-player">
                <a href="/player/<%= p.player_id %>" class="gl-player-link"><%= p.username || p.player_id %></a>
              </td>
              <td class="gl-cell-elo"><%= p.elo_rating || 1000 %></td>
              <td class="gl-cell-tier">
                <span class="gl-tier-chip gl-tier-<%= (p.tier || {}).nameEn ? (p.tier.nameEn || 'Bronze').toLowerCase().replace(' ', '-') : 'bronze' %>">
                  <%= (p.tier || {}).emoji || '' %> <%= (p.tier || {}).name || 'Bronze' %>
                </span>
              </td>
              <td><%= p.games_played || 0 %></td>
              <td><%= p.games_won || 0 %></td>
              <td>
                <span class="gl-wr <%= wr >= 60 ? 'gl-wr-high' : wr >= 40 ? 'gl-wr-mid' : 'gl-wr-low' %>"><%= wr %>%</span>
              </td>
              <td><%= p.wolf_wins || 0 %></td>
              <td><%= p.village_wins || 0 %></td>
              <td class="gl-cell-streak"><%= p.best_win_streak || 0 %> ğŸ”¥</td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
  </section>

<% } %>

<%- include('partials/footer') %>
