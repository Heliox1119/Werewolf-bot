<%- include('partials/header') %>

<!-- ‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê -->
<section class="iv-hero">
  <div class="iv-hero-bg">
    <div class="iv-hero-gradient"></div>
    <div class="iv-hero-dots"></div>
    <div class="iv-hero-scanline"></div>
    <div class="iv-hero-moon"></div>
  </div>
  <div class="iv-hero-inner">
    <div class="iv-hero-badge" data-i18n="invite.badge">üê∫ WEREWOLF BOT</div>
    <h1 class="iv-hero-title">
      <span class="iv-title-line" data-i18n="invite.hero_line1">La nuit tombe sur</span>
      <span class="iv-title-guild"><%= guildName %></span>
    </h1>
    <p class="iv-hero-desc" data-i18n="invite.hero_desc">
      Plongez votre serveur dans l'univers du Loup-Garou. Trahisons, strat√©gie, et fous rires garantis.
    </p>
    <div class="iv-hero-cta">
      <a href="<%= inviteUrl %>" target="_blank" rel="noopener" class="iv-btn-invite">
        <svg width="22" height="22" viewBox="0 -28.5 256 256" fill="currentColor"><path d="M216.856 16.597A208.502 208.502 0 00164.042 0c-2.275 4.113-4.933 9.645-6.766 14.046-19.692-2.961-39.203-2.961-58.533 0-1.832-4.4-4.55-9.933-6.846-14.046a207.809 207.809 0 00-52.855 16.638C5.618 67.147-3.443 116.4 1.087 164.956c22.169 16.555 43.653 26.612 64.775 33.193a161.094 161.094 0 0013.96-22.765 136.2 136.2 0 01-21.958-10.632c1.839-1.36 3.637-2.78 5.38-4.252 42.371 19.702 88.344 19.702 130.169 0 1.764 1.472 3.562 2.893 5.38 4.252-6.992 4.2-14.4 7.7-21.998 10.652 3.832 7.533 8.408 14.792 13.981 22.745 21.142-6.58 42.646-16.637 64.815-33.213 5.316-56.288-9.08-105.09-38.056-148.36zM85.474 135.095c-12.645 0-23.015-11.805-23.015-26.18s10.149-26.2 23.015-26.2c12.867 0 23.236 11.823 23.015 26.2.02 14.375-10.148 26.18-23.015 26.18zm85.051 0c-12.645 0-23.014-11.805-23.014-26.18s10.148-26.2 23.014-26.2c12.867 0 23.236 11.823 23.015 26.2 0 14.375-10.148 26.18-23.015 26.18z"/></svg>
        <span data-i18n="invite.btn_invite">Installer sur le serveur</span>
      </a>
      <span class="iv-hero-hint" data-i18n="invite.hint_free">100% gratuit &middot; Aucune carte requise</span>
    </div>
    <% if (guildIcon) { %>
      <div class="iv-hero-guild-preview">
        <div class="iv-guild-avatar-wrap">
          <img src="<%= guildIcon %>" alt="<%= guildName %>" class="iv-guild-avatar">
          <div class="iv-guild-ring"></div>
          <div class="iv-guild-ring iv-guild-ring-lg"></div>
        </div>
        <span class="iv-guild-name"><%= guildName %></span>
      </div>
    <% } %>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê ROLE CAROUSEL ‚ïê‚ïê‚ïê -->
<section class="iv-roles">
  <div class="iv-section-head">
    <span class="iv-section-tag" data-i18n="invite.tag_roles">üé≠ Les r√¥les</span>
    <h2 class="iv-section-title" data-i18n="invite.roles_title">Qui serez-vous cette nuit ?</h2>
  </div>
  <div class="iv-roles-track">
    <div class="iv-roles-slider" id="iv-roles-slider">
      <%
        var campIcons  = { village: 'üè°', wolves: 'üê∫', solo: '‚öîÔ∏è' };
        var campLabels = { village: 'Village', wolves: 'Loups', solo: 'Solo' };
        var carouselOrder = ['WEREWOLF','SEER','WITCH','HUNTER','CUPID','WHITE_WOLF','SALVATEUR','THIEF','VILLAGER','PETITE_FILLE','ANCIEN','IDIOT'];
        carouselOrder.forEach(function(rid, idx) {
          var role = roleData.getRoleById(rid);
          if (!role) return;
      %>
        <div class="iv-role-card" style="--i:<%= idx %>">
          <img src="/static/img/roles/<%= role.image %>" alt="<%= role.name.fr %>" class="iv-role-img" loading="lazy">
          <span class="iv-role-name" data-i18n="role.name.<%= rid.toLowerCase() %>"><%= role.name.fr %></span>
          <span class="iv-role-camp iv-camp-<%= role.camp %>" data-i18n="invite.camp_<%= role.camp %>"><%= campIcons[role.camp] %> <%= campLabels[role.camp] %></span>
        </div>
      <% }); %>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê CARD DECK DRAW ‚Äî PREMIUM ‚ïê‚ïê‚ïê -->
<section class="iv-deck">
  <div class="iv-section-head">
    <span class="iv-section-tag" data-i18n="invite.tag_discovery">üÉè D√©couverte</span>
    <h2 class="iv-section-title" data-i18n="invite.deck_title">S√©lectionnez une carte</h2>
    <p class="iv-section-sub" data-i18n="invite.deck_sub">D√©couvrez les r√¥les du jeu en piochant dans le deck.</p>
  </div>
  <div class="ivd-stage">
    <div class="ivd-deck-wrap">
      <div class="ivd-deck" id="ivd-deck">
        <div class="ivd-card ivd-c1"></div>
        <div class="ivd-card ivd-c2"></div>
        <div class="ivd-card ivd-c3"></div>
        <div class="ivd-card ivd-c4"></div>
        <div class="ivd-card ivd-c5"></div>
        <div class="ivd-card ivd-ctop"></div>
      </div>
      <div class="ivd-glow" id="ivd-glow"></div>
    </div>
    <button class="ivd-btn" id="ivd-btn" type="button">
      <span class="ivd-btn-icon">üé¥</span>
      <span class="ivd-btn-text" data-i18n="invite.deck_draw">S√©lectionnez une carte</span>
    </button>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê FEATURES SHOWCASE ‚ïê‚ïê‚ïê -->
<section class="iv-features">
  <div class="iv-section-head">
    <span class="iv-section-tag" data-i18n="invite.tag_features">‚ú® Fonctionnalit√©s</span>
    <h2 class="iv-section-title" data-i18n="invite.features_title">Tout pour une exp√©rience parfaite</h2>
    <p class="iv-section-sub" data-i18n="invite.features_sub">Un bot complet, pens√© pour le fun et la comp√©tition.</p>
  </div>
  <div class="iv-features-grid">
    <div class="iv-feat" style="--i:0">
      <div class="iv-feat-icon iv-fi-game">üéÆ</div>
      <div class="iv-feat-body">
        <h3 data-i18n="invite.feat_game">Partie compl√®te</h3>
        <p data-i18n="invite.feat_game_d">Phases jour/nuit automatis√©es, votes, actions nocturnes et gestion du capitaine.</p>
      </div>
    </div>
    <div class="iv-feat" style="--i:1">
      <div class="iv-feat-icon iv-fi-roles">üé≠</div>
      <div class="iv-feat-body">
        <h3 data-i18n="invite.feat_roles">12+ r√¥les uniques</h3>
        <p data-i18n="invite.feat_roles_d">Voyante, Sorci√®re, Chasseur, Cupidon, Loup Blanc, Voleur, et bien d'autres.</p>
      </div>
    </div>
    <div class="iv-feat" style="--i:2">
      <div class="iv-feat-icon iv-fi-voice">üîä</div>
      <div class="iv-feat-body">
        <h3 data-i18n="invite.feat_voice">Gestion vocale</h3>
        <p data-i18n="invite.feat_voice_d">Mute/unmute automatique des joueurs la nuit. Immersion totale garantie.</p>
      </div>
    </div>
    <div class="iv-feat" style="--i:3">
      <div class="iv-feat-icon iv-fi-stats">üìä</div>
      <div class="iv-feat-body">
        <h3 data-i18n="invite.feat_stats">Stats & ELO</h3>
        <p data-i18n="invite.feat_stats_d">Classement comp√©titif, historique, achievements et statistiques d√©taill√©es.</p>
      </div>
    </div>
    <div class="iv-feat" style="--i:4">
      <div class="iv-feat-icon iv-fi-lang">üåê</div>
      <div class="iv-feat-body">
        <h3 data-i18n="invite.feat_lang">Multilingue</h3>
        <p data-i18n="invite.feat_lang_d">Support complet Fran√ßais et Anglais. Changez la langue avec /lang.</p>
      </div>
    </div>
    <div class="iv-feat" style="--i:5">
      <div class="iv-feat-icon iv-fi-dash">üñ•Ô∏è</div>
      <div class="iv-feat-body">
        <h3 data-i18n="invite.feat_dash">Dashboard web</h3>
        <p data-i18n="invite.feat_dash_d">Interface web compl√®te pour g√©rer vos parties, stats et configuration du bot.</p>
      </div>
    </div>
  </div>
</section>

<!-- Card reveal modal -->
<div class="ivd-overlay" id="ivd-overlay">
  <div class="ivd-smoke" id="ivd-smoke"></div>
  <div class="ivd-modal" id="ivd-modal">
    <button class="ivd-modal-close" id="ivd-modal-close" type="button" aria-label="Fermer" data-i18n-aria-label="ui.close">&times;</button>
    <div class="ivd-modal-card">
      <img src="" alt="" class="ivd-modal-img" id="ivd-modal-img">
      <div class="ivd-modal-card-glow"></div>
    </div>
    <div class="ivd-modal-info">
      <h3 class="ivd-modal-name" id="ivd-modal-name"></h3>
      <span class="ivd-modal-camp" id="ivd-modal-camp"></span>
      <p class="ivd-modal-desc" id="ivd-modal-desc"></p>
      <code class="ivd-modal-cmd" id="ivd-modal-cmd"></code>
    </div>
    <button class="ivd-btn ivd-btn-redraw" id="ivd-btn-redraw" type="button">
      <span class="ivd-btn-icon">üé¥</span>
      <span class="ivd-btn-text" data-i18n="invite.deck_redraw">Tirer une nouvelle carte</span>
    </button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê PERMISSIONS ‚ïê‚ïê‚ïê -->
<section class="iv-perms">
  <div class="iv-section-head">
    <span class="iv-section-tag" data-i18n="invite.tag_perms">üîí Permissions</span>
    <h2 class="iv-section-title" data-i18n="invite.perms_title">Droits requis</h2>
    <p class="iv-section-sub" data-i18n="invite.perms_sub">Le bot ne demande que les permissions strictement n√©cessaires au jeu.</p>
  </div>
  <div class="iv-perms-grid">
    <div class="iv-perm" style="--i:0">
      <span class="iv-perm-check">‚úì</span>
      <div>
        <strong data-i18n="invite.perm_commands">Slash Commands</strong>
        <p data-i18n="invite.perm_commands_desc">Enregistrer et r√©pondre aux commandes /</p>
      </div>
    </div>
    <div class="iv-perm" style="--i:1">
      <span class="iv-perm-check">‚úì</span>
      <div>
        <strong data-i18n="invite.perm_messages">Envoyer des messages</strong>
        <p data-i18n="invite.perm_messages_desc">Annonces de jeu et mises √† jour</p>
      </div>
    </div>
    <div class="iv-perm" style="--i:2">
      <span class="iv-perm-check">‚úì</span>
      <div>
        <strong data-i18n="invite.perm_manage_channels">G√©rer les salons</strong>
        <p data-i18n="invite.perm_manage_channels_desc">Cr√©er les salons priv√©s du jeu</p>
      </div>
    </div>
    <div class="iv-perm" style="--i:3">
      <span class="iv-perm-check">‚úì</span>
      <div>
        <strong data-i18n="invite.perm_voice">Rendre muet</strong>
        <p data-i18n="invite.perm_voice_desc">G√©rer le vocal pendant les phases de nuit</p>
      </div>
    </div>
    <div class="iv-perm" style="--i:4">
      <span class="iv-perm-check">‚úì</span>
      <div>
        <strong data-i18n="invite.perm_embed">Int√©grer des liens</strong>
        <p data-i18n="invite.perm_embed_desc">Embeds riches pour l'interface de jeu</p>
      </div>
    </div>
    <div class="iv-perm" style="--i:5">
      <span class="iv-perm-check">‚úì</span>
      <div>
        <strong data-i18n="invite.perm_roles">G√©rer les r√¥les</strong>
        <p data-i18n="invite.perm_roles_desc">Attribution des r√¥les et permissions de jeu</p>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê FINAL CTA ‚ïê‚ïê‚ïê -->
<section class="iv-cta">
  <div class="iv-cta-glow"></div>
  <div class="iv-cta-inner">
    <span class="iv-cta-wolf">üê∫</span>
    <h2 class="iv-cta-title" data-i18n="invite.cta_title">Pr√™t √† jouer ?</h2>
    <p class="iv-cta-desc" data-i18n="invite.cta_desc">Installez le bot en un clic et lancez votre premi√®re partie en quelques secondes.</p>
    <a href="<%= inviteUrl %>" target="_blank" rel="noopener" class="iv-btn-invite iv-btn-invite-lg">
      <svg width="22" height="22" viewBox="0 -28.5 256 256" fill="currentColor"><path d="M216.856 16.597A208.502 208.502 0 00164.042 0c-2.275 4.113-4.933 9.645-6.766 14.046-19.692-2.961-39.203-2.961-58.533 0-1.832-4.4-4.55-9.933-6.846-14.046a207.809 207.809 0 00-52.855 16.638C5.618 67.147-3.443 116.4 1.087 164.956c22.169 16.555 43.653 26.612 64.775 33.193a161.094 161.094 0 0013.96-22.765 136.2 136.2 0 01-21.958-10.632c1.839-1.36 3.637-2.78 5.38-4.252 42.371 19.702 88.344 19.702 130.169 0 1.764 1.472 3.562 2.893 5.38 4.252-6.992 4.2-14.4 7.7-21.998 10.652 3.832 7.533 8.408 14.792 13.981 22.745 21.142-6.58 42.646-16.637 64.815-33.213 5.316-56.288-9.08-105.09-38.056-148.36zM85.474 135.095c-12.645 0-23.015-11.805-23.015-26.18s10.149-26.2 23.015-26.2c12.867 0 23.236 11.823 23.015 26.2.02 14.375-10.148 26.18-23.015 26.18zm85.051 0c-12.645 0-23.014-11.805-23.014-26.18s10.148-26.2 23.014-26.2c12.867 0 23.236 11.823 23.015 26.2 0 14.375-10.148 26.18-23.015 26.18z"/></svg>
      <span data-i18n="invite.btn_invite">Installer sur le serveur</span>
    </a>
  </div>
</section>

<a href="/" class="iv-back-link" data-i18n="invite.back">‚Üê Retour au Dashboard</a>

<!-- Role carousel auto-scroll -->
<script>
(function() {
  var slider = document.getElementById('iv-roles-slider');
  if (!slider) return;
  var speed = 0.4;
  var pos = 0;
  var paused = false;
  slider.addEventListener('mouseenter', function() { paused = true; });
  slider.addEventListener('mouseleave', function() { paused = false; });
  function tick() {
    if (!paused) {
      pos += speed;
      if (pos >= slider.scrollWidth / 2) pos = 0;
      slider.style.transform = 'translateX(-' + pos + 'px)';
    }
    requestAnimationFrame(tick);
  }
  // Duplicate cards for infinite scroll
  slider.innerHTML += slider.innerHTML;
  requestAnimationFrame(tick);

  // Scroll-reveal for sections
  var sections = document.querySelectorAll('.iv-features, .iv-roles, .iv-deck, .iv-perms, .iv-cta');
  var obs = new IntersectionObserver(function(entries) {
    entries.forEach(function(e) {
      if (e.isIntersecting) { e.target.classList.add('iv-visible'); obs.unobserve(e.target); }
    });
  }, { threshold: 0.15 });
  sections.forEach(function(s) { obs.observe(s); });
})();

/* ‚îÄ‚îÄ Card Deck Draw ‚Äî Premium cinematic ‚îÄ‚îÄ */
(function() {
  'use strict';
  var t = function(k) { return window.webI18n ? window.webI18n.t(k) : k; };

  var CAMP_KEYS = { wolves: 'iv.camp_wolves', village: 'iv.camp_village', solo: 'iv.camp_solo' };

  var ROLES = [
    { nameKey: 'iv.role_werewolf', camp: 'wolves', img: 'loupSimple.webp', cmd: '/kill @joueur', descKey: 'iv.desc_werewolf' },
    { nameKey: 'iv.role_villager', camp: 'village', img: 'villageois.webp', cmd: '/vote @joueur', descKey: 'iv.desc_villager' },
    { nameKey: 'iv.role_seer', camp: 'village', img: 'voyante.webp', cmd: '/see @joueur', descKey: 'iv.desc_seer' },
    { nameKey: 'iv.role_witch', camp: 'village', img: 'sorciere.png', cmd: '/potion vie|mort @joueur', descKey: 'iv.desc_witch' },
    { nameKey: 'iv.role_hunter', camp: 'village', img: 'chasseur.webp', cmd: '/shoot @joueur', descKey: 'iv.desc_hunter' },
    { nameKey: 'iv.role_white_wolf', camp: 'solo', img: 'loupBlanc.webp', cmd: '/kill @joueur', descKey: 'iv.desc_white_wolf' },
    { nameKey: 'iv.role_little_girl', camp: 'village', img: 'petiteFille.webp', cmd: '/listen', descKey: 'iv.desc_little_girl' },
    { nameKey: 'iv.role_cupid', camp: 'village', img: 'cupidon.webp', cmd: '/love @j1 @j2', descKey: 'iv.desc_cupid' },
    { nameKey: 'iv.role_guardian', camp: 'village', img: 'salvateur.webp', cmd: '/protect @joueur', descKey: 'iv.desc_guardian' },
    { nameKey: 'iv.role_elder', camp: 'village', img: 'ancien.webp', cmd: '/vote @joueur', descKey: 'iv.desc_elder' },
    { nameKey: 'iv.role_idiot', camp: 'village', img: 'idiot.webp', cmd: '/vote @joueur', descKey: 'iv.desc_idiot' },
    { nameKey: 'iv.role_thief', camp: 'village', img: 'voleur.webp', cmd: '/steal @carte', descKey: 'iv.desc_thief' }
  ];

  var CAMP_CSS = { wolves: 'ivd-camp-wolves', village: 'ivd-camp-village', solo: 'ivd-camp-solo' };

  var deck = document.getElementById('ivd-deck');
  var glow = document.getElementById('ivd-glow');
  var btnDraw = document.getElementById('ivd-btn');
  var btnRedraw = document.getElementById('ivd-btn-redraw');
  var overlay = document.getElementById('ivd-overlay');
  var modal = document.getElementById('ivd-modal');
  var btnClose = document.getElementById('ivd-modal-close');
  var imgEl = document.getElementById('ivd-modal-img');
  var nameEl = document.getElementById('ivd-modal-name');
  var campEl = document.getElementById('ivd-modal-camp');
  var descEl = document.getElementById('ivd-modal-desc');
  var cmdEl = document.getElementById('ivd-modal-cmd');

  if (!deck || !btnDraw) return;

  // Move overlay to <body> so position:fixed isn't trapped by
  // .main-content's will-change / filter (which creates a new containing block)
  document.body.appendChild(overlay);

  var busy = false;
  var lastIndex = -1;

  function pickRole() {
    var idx;
    do { idx = Math.floor(Math.random() * ROLES.length); } while (idx === lastIndex && ROLES.length > 1);
    lastIndex = idx;
    return ROLES[idx];
  }

  function closeModal() {
    overlay.classList.remove('ivd-active');
    // Reset deck dealing state
    deck.classList.remove('ivd-dealing');
    // Restore top card visibility
    var top = deck.querySelector('.ivd-ctop');
    if (top) { top.style.opacity = ''; top.style.transform = ''; }
    busy = false;
  }

  function drawCard() {
    if (busy && !overlay.classList.contains('ivd-active')) return;
    busy = true;
    btnDraw.disabled = true;
    if (btnRedraw) btnRedraw.disabled = true;

    // Close modal if open (for redraw)
    var wasOpen = overlay.classList.contains('ivd-active');
    if (wasOpen) {
      overlay.classList.remove('ivd-active');
    }

    var role = pickRole();
    var delay = wasOpen ? 400 : 0;

    setTimeout(function() {
      // Reset deck
      deck.classList.remove('ivd-dealing', 'ivd-shuffling');
      var top = deck.querySelector('.ivd-ctop');
      if (top) { top.style.opacity = ''; top.style.transform = ''; }

      // Phase 1: Glow appears
      glow.style.opacity = '0.7';

      // Phase 2: Shuffle (1.8s)
      deck.classList.add('ivd-shuffling');

      setTimeout(function() {
        deck.classList.remove('ivd-shuffling');

        // Phase 3: Deal ‚Äî top card flies out
        deck.classList.add('ivd-dealing');

        setTimeout(function() {
          // Populate modal
          var roleName = t(role.nameKey);
          var roleDesc = t(role.descKey);
          var campLabel = t(CAMP_KEYS[role.camp] || role.camp);
          imgEl.src = '/static/img/roles/' + role.img;
          imgEl.alt = roleName;
          nameEl.textContent = roleName;
          campEl.textContent = campLabel;
          campEl.className = 'ivd-modal-camp ' + (CAMP_CSS[role.camp] || '');
          descEl.textContent = roleDesc;
          if (role.cmd) {
            cmdEl.textContent = role.cmd;
            cmdEl.style.display = '';
          } else {
            cmdEl.style.display = 'none';
          }

          // Phase 4: Show overlay + modal
          glow.style.opacity = '0';
          overlay.classList.add('ivd-active');

          btnDraw.disabled = false;
          if (btnRedraw) btnRedraw.disabled = false;
          // busy stays true until modal closes (except redraw)
        }, 800);
      }, 1900);
    }, delay);
  }

  btnDraw.addEventListener('click', drawCard);
  if (btnRedraw) btnRedraw.addEventListener('click', drawCard);

  // Close modal
  btnClose.addEventListener('click', closeModal);
  overlay.addEventListener('click', function(e) {
    if (e.target === overlay || e.target.classList.contains('ivd-smoke')) closeModal();
  });
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && overlay.classList.contains('ivd-active')) closeModal();
  });
})();
</script>

<%- include('partials/footer') %>
