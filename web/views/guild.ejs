<%- include('partials/header') %>

<div class="guild-page">
  <div class="page-header">
    <% if (guild && guild.icon) { %>
      <img src="<%= guild.icon %>" alt="" class="guild-icon-lg">
    <% } %>
    <div>
      <h1><%= guild ? guild.name : 'Guild ' + guildId %></h1>
      <p class="text-muted"><%= guild ? guild.memberCount + ' members' : '' %></p>
    </div>
  </div>

  <!-- Active Games -->
  <section class="section">
    <h2 class="section-title"><span class="pulse-dot"></span> Active Games</h2>
    <div class="games-grid">
      <% if (games.length === 0) { %>
        <div class="empty-state"><span class="empty-icon">&#127769;</span><p>No active games</p></div>
      <% } else { games.forEach(function(g) { %>
        <a href="/game/<%= g.gameId %>" class="game-card" data-game="<%= g.gameId %>">
          <div class="game-card-header">
            <span class="game-phase phase-<%= (g.phase || 'lobby').toLowerCase() %>"><%= g.phase || 'Lobby' %></span>
            <span class="game-day"><%= g.dayCount ? 'Day ' + g.dayCount : '' %></span>
          </div>
          <div class="game-card-body">
            <div class="game-players">
              <span class="alive-count">&#10084; <%= g.players ? g.players.filter(function(p){ return p.alive; }).length : 0 %> alive</span>
              <span class="dead-count">&#9760; <%= g.dead ? g.dead.length : 0 %> dead</span>
            </div>
          </div>
          <div class="game-card-footer"><span class="spectate-btn">&#128065; Spectate</span></div>
        </a>
      <% }); } %>
    </div>
  </section>

  <!-- Leaderboard -->
  <section class="section">
    <h2 class="section-title">Top Players</h2>
    <% if (leaderboard.length === 0) { %>
      <p class="text-muted">No ranked players yet.</p>
    <% } else { %>
      <div class="leaderboard-table">
        <table>
          <thead>
            <tr><th>#</th><th>Player</th><th>ELO</th><th>Tier</th><th>Games</th><th>Wins</th></tr>
          </thead>
          <tbody>
            <% leaderboard.forEach(function(p) { %>
              <tr>
                <td class="rank-col"><%= p.rank %></td>
                <td><a href="/player/<%= p.player_id %>"><%= p.username || p.player_id %></a></td>
                <td><strong><%= p.elo_rating || 1000 %></strong></td>
                <td><span class="tier tier-<%= (p.tier || {}).id || 'bronze' %>"><%= (p.tier || {}).emoji || '' %> <%= (p.tier || {}).name || 'Bronze' %></span></td>
                <td><%= p.games_played || 0 %></td>
                <td><%= p.games_won || 0 %></td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>
  </section>

  <!-- History -->
  <section class="section">
    <h2 class="section-title">Recent Games</h2>
    <% if (history.length === 0) { %>
      <p class="text-muted">No game history yet.</p>
    <% } else { %>
      <div class="history-list">
        <% history.forEach(function(h) { %>
          <div class="history-item">
            <span class="history-winner"><%= h.winner || '?' %></span>
            <span class="history-players"><%= h.player_count || '?' %> players</span>
            <span class="history-date"><%= h.ended_at ? new Date(h.ended_at).toLocaleDateString() : '' %></span>
          </div>
        <% }); %>
      </div>
    <% } %>
  </section>
</div>

<%- include('partials/footer') %>
