<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> â€” Werewolf Bot</title>
  <meta name="description" content="Werewolf Bot â€” Real-time Discord game dashboard">
  <meta name="theme-color" content="#080b14">
  <link rel="icon" href="/static/img/roles/LG.jpg" type="image/jpeg">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<%
  // Determine which pages show the guild sidebar
  var showGuildSidebar = title === 'Dashboard'
    || typeof guildId !== 'undefined'
    || typeof gameId !== 'undefined'
    || typeof playerId !== 'undefined';
  // Determine if we're on a guild-specific page (show secondary sidebar)
  var activeGuildId = typeof guildId !== 'undefined' ? guildId : null;
  var activeGuild = null;
  if (activeGuildId && typeof userGuilds !== 'undefined') {
    activeGuild = userGuilds.find(function(g) { return g.id === activeGuildId; });
  }
  // Detect which guild sub-page we're on (for active state in panel)
  var guildPage = typeof guildPage !== 'undefined' ? guildPage : 'overview';
%>
<body data-page="<%= showGuildSidebar ? 'guild' : 'full' %>">
  <!-- Top Header -->
  <nav class="navbar">
    <div class="nav-container">
      <!-- Left: Brand + Nav Tabs -->
      <div class="nav-left">
        <a href="/" class="nav-brand">
          <img src="/static/img/roles/LG.jpg" alt="Werewolf" class="nav-logo">
          <span class="nav-title"><%= typeof botName !== 'undefined' && botName ? botName : 'Werewolf' %></span>
          <span class="nav-version">v3.0</span>
        </a>
        <div class="nav-tabs" id="nav-tabs">
          <a href="/" class="nav-tab<%= title === 'Dashboard' ? ' active' : '' %>" data-i18n="nav.dashboard">Dashboard</a>
          <a href="/docs" class="nav-tab<%= title === 'Documentation' ? ' active' : '' %>" data-i18n="nav.docs">Documentation</a>
          <a href="/premium" class="nav-tab<%= title === 'Premium' ? ' active' : '' %>" data-i18n="nav.premium">Premium</a>
          <a href="/status" class="nav-tab<%= title === 'Status' ? ' active' : '' %>" data-i18n="nav.status">Status</a>
          <div class="nav-tab-dropdown">
            <a href="/support" class="nav-tab<%= title === 'Support' ? ' active' : '' %>" data-i18n="nav.support">Support</a>
            <div class="nav-dropdown-menu">
              <a href="https://github.com/Heliox1119/Werewolf-bot" target="_blank" rel="noopener" class="nav-dropdown-item">
                <span class="nav-dropdown-icon">&#128187;</span>
                <span>GitHub</span>
              </a>
              <a href="/support#discord" class="nav-dropdown-item">
                <span class="nav-dropdown-icon">&#128172;</span>
                <span>Discord</span>
              </a>
              <a href="/support" class="nav-dropdown-item">
                <span class="nav-dropdown-icon">&#10067;</span>
                <span data-i18n="nav.faq">FAQ</span>
              </a>
            </div>
          </div>

        </div>
      </div>

      <!-- Right: User dropdown or Login -->
      <div class="nav-right">
        <% if (typeof user !== 'undefined' && user) { %>
          <div class="nav-user-dropdown" id="nav-user-dropdown">
            <button class="nav-user-btn" id="nav-user-btn" type="button">
              <img src="https://cdn.discordapp.com/avatars/<%= user.id %>/<%= user.avatar %>.png?size=32" alt="" class="nav-avatar">
              <span class="nav-username"><%= user.username %></span>
              <% if (typeof accessLevel !== 'undefined' && accessLevel !== 'public') { %>
                <span class="access-badge access-<%= accessLevel %>"><%= accessLevel === 'owner' ? 'ðŸ‘‘' : accessLevel === 'admin' ? 'ðŸ›¡ï¸' : 'ðŸ‘¤' %></span>
              <% } %>
              <span class="nav-user-chevron">&#9660;</span>
            </button>
            <div class="nav-user-menu" id="nav-user-menu">
              <a href="/" class="nav-user-menu-item">
                <span class="nav-user-menu-icon">&#127968;</span>
                <span data-i18n="nav.dashboard">Dashboard</span>
              </a>
              <button class="nav-user-menu-item" id="user-menu-lang" type="button">
                <span class="nav-user-menu-icon" id="user-menu-lang-flag">ðŸ‡¬ðŸ‡§</span>
                <span data-i18n="nav.language">Language</span>
              </button>
              <div class="nav-user-menu-sep"></div>
              <a href="/auth/logout" class="nav-user-menu-item nav-user-menu-danger">
                <span class="nav-user-menu-icon">&#128682;</span>
                <span data-i18n="nav.logout">Logout</span>
              </a>
            </div>
          </div>
        <% } else { %>
          <a href="/auth/discord" class="btn btn-sm btn-discord">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286z"/></svg>
            <span data-i18n="nav.login">Login</span>
          </a>
        <% } %>
      </div>

      <button class="nav-toggle" id="nav-toggle" aria-label="Menu">&#9776;</button>
    </div>
  </nav>

  <!-- Left Guild Sidebar (Discord-style) â€” only on guild pages -->
  <% if (showGuildSidebar) { %>
  <aside class="guild-sidebar" id="guild-sidebar">
    <div class="guild-sidebar-list" id="sidebar-guilds">
      <% if (typeof userGuilds !== 'undefined' && userGuilds.length > 0) { %>
        <% userGuilds.forEach(function(g) { %>
          <a href="<%= g.botPresent ? '/guild/' + g.id : '/invite/' + g.id %>" class="sidebar-guild<%= !g.botPresent ? ' sidebar-guild-nobot' : '' %><%= (activeGuildId && g.id === activeGuildId) ? ' active' : '' %>" title="<%= g.name %>" data-guild-id="<%= g.id %>">
            <% if (g.icon) { %>
              <img src="<%= g.icon %>" alt="<%= g.name %>" class="sidebar-guild-img<%= !g.botPresent ? ' sidebar-guild-img-dim' : '' %>">
            <% } else { %>
              <span class="sidebar-guild-initial"><%= g.name ? g.name.charAt(0).toUpperCase() : '?' %></span>
            <% } %>
            <% if (!g.botPresent) { %>
              <span class="sidebar-guild-badge">+</span>
            <% } %>
          </a>
        <% }); %>
      <% } else { %>
        <a href="/auth/discord" class="sidebar-guild sidebar-guild-add" title="Login to see your servers">
          <span class="sidebar-guild-initial">+</span>
        </a>
      <% } %>
    </div>
  </aside>
  <% } %>

  <% if (showGuildSidebar && activeGuildId && activeGuild) { %>
  <!-- Secondary Guild Sidebar (management menu) -->
  <aside class="guild-panel" id="guild-panel">
    <div class="guild-panel-header">
      <% if (activeGuild.icon) { %>
        <img src="<%= activeGuild.icon %>" alt="" class="guild-panel-avatar">
      <% } else { %>
        <span class="guild-panel-initial"><%= activeGuild.name ? activeGuild.name.charAt(0).toUpperCase() : '?' %></span>
      <% } %>
      <span class="guild-panel-name"><%= activeGuild.name || 'Server' %></span>
      <div class="guild-panel-settings-wrap" id="sidebar-settings-wrap">
        <button class="guild-panel-settings" id="sidebar-settings-btn" type="button" title="Settings">&#9881;</button>
        <div class="guild-panel-settings-popup" id="sidebar-settings-popup">
          <button class="guild-panel-settings-lang" id="sidebar-lang-toggle" type="button">
            <span id="sidebar-lang-flag">&#127760;</span>
            <span data-i18n="nav.language">Langue</span>
          </button>
        </div>
      </div>
    </div>
    <nav class="guild-panel-nav">
      <a href="/guild/<%= activeGuildId %>" class="guild-panel-item<%= guildPage === 'overview' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#127918;</span>
        <span data-i18n="guild.overview">Vue d'ensemble</span>
      </a>
      <a href="/guild/<%= activeGuildId %>/leaderboard" class="guild-panel-item<%= guildPage === 'leaderboard' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#127942;</span>
        <span data-i18n="guild.leaderboard">Classement</span>
      </a>
      <a href="/guild/<%= activeGuildId %>/history" class="guild-panel-item<%= guildPage === 'history' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#128218;</span>
        <span data-i18n="guild.history">Historique</span>
      </a>
      <% if (typeof accessLevel !== 'undefined' && (accessLevel === 'owner' || accessLevel === 'admin')) { %>
      <div class="guild-panel-sep"></div>
      <span class="guild-panel-label" data-i18n="guild.admin_section">Administration</span>
      <a href="/guild/<%= activeGuildId %>/moderation" class="guild-panel-item<%= guildPage === 'moderation' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#128737;</span>
        <span data-i18n="nav.moderation">ModÃ©ration</span>
      </a>
      <a href="/guild/<%= activeGuildId %>/rules" class="guild-panel-item<%= guildPage === 'rules' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#9881;</span>
        <span data-i18n="guild.rules">RÃ¨gles du jeu</span>
      </a>
      <% } %>
    </nav>
  </aside>
  <% } %>

  <!-- Main content wrapper -->
  <div class="app-main<%= (showGuildSidebar && activeGuildId && activeGuild) ? ' has-guild-panel' : '' %>" id="app-main">
    <main class="main-content">
