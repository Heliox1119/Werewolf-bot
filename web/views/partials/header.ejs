<!DOCTYPE html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %> â€” Werewolf Bot</title>
  <meta name="description" content="Werewolf Bot â€” Real-time Discord game dashboard" data-i18n-content="meta.description">
  <meta name="theme-color" content="#080b14">
  <link rel="icon" href="/static/img/roles/LG.jpg" type="image/jpeg">
  <link rel="stylesheet" href="/static/css/style.css?v=3.4.2">
  <script>
    // Synchronous i18n pre-apply: prevent FOUC of wrong language
    (function(){
      var lang = localStorage.getItem('werewolf-lang') || 'fr';
      document.documentElement.lang = lang;
      document.documentElement.setAttribute('data-lang', lang);
    })();
  </script>
  <style>
    /* Hide translatable elements until i18n applies (prevents flash of wrong language) */
    html:not([data-i18n-ready]) [data-i18n],
    html:not([data-i18n-ready]) .pp-date { visibility: hidden; }
  </style>
</head>
<%
  // Determine which pages show the guild sidebar
  var showGuildSidebar = title === 'Dashboard'
    || typeof guildId !== 'undefined'
    || typeof gameId !== 'undefined'
    || typeof playerId !== 'undefined';
  // Determine if we're on a guild-specific page (show secondary sidebar)
  var activeGuildId = typeof guildId !== 'undefined' ? guildId : null;
  var activeGuild = null;
  if (activeGuildId && typeof userGuilds !== 'undefined') {
    activeGuild = userGuilds.find(function(g) { return g.id === activeGuildId; });
  }
  // Detect which guild sub-page we're on (for active state in panel)
  var guildPage = typeof guildPage !== 'undefined' ? guildPage : 'overview';
%>
<body data-page="<%= showGuildSidebar ? 'guild' : 'full' %>">
  <!-- Page transition loader bar -->
  <div class="page-loader" id="page-loader"></div>
  <!-- Top Header -->
  <nav class="navbar">
    <div class="nav-container">
      <!-- Left: Brand + Nav Tabs -->
      <div class="nav-left">
        <a href="/" class="nav-brand">
          <img src="/static/img/roles/LG.jpg" alt="Werewolf" class="nav-logo">
          <span class="nav-title"><%= typeof botName !== 'undefined' && botName ? botName : 'Werewolf' %></span>
          <span class="nav-version">v3.5</span>
        </a>
        <div class="nav-tabs" id="nav-tabs">
          <a href="/" class="nav-tab<%= title === 'Dashboard' ? ' active' : '' %>" data-i18n="nav.dashboard">Dashboard</a>
          <a href="/docs" class="nav-tab<%= title === 'Documentation' ? ' active' : '' %>" data-i18n="nav.docs">Documentation</a>
          <a href="/premium" class="nav-tab<%= title === 'Premium' ? ' active' : '' %>" data-i18n="nav.premium">Premium</a>
          <a href="/status" class="nav-tab<%= title === 'Status' ? ' active' : '' %>" data-i18n="nav.status">Status</a>
          <div class="nav-tab-dropdown">
            <a href="/support" class="nav-tab<%= title === 'Support' ? ' active' : '' %>" data-i18n="nav.support">Support</a>
            <div class="nav-dropdown-menu">
              <div class="nav-dropdown-menu-inner">
              <a href="https://github.com/Heliox1119/Werewolf-bot" target="_blank" rel="noopener" class="nav-dropdown-item">
                <span class="nav-dropdown-icon">&#128187;</span>
                <span data-i18n="nav.github">GitHub</span>
              </a>
              <a href="/support#discord" class="nav-dropdown-item">
                <span class="nav-dropdown-icon">&#128172;</span>
                <span data-i18n="nav.discord">Discord</span>
              </a>
              <a href="/support" class="nav-dropdown-item">
                <span class="nav-dropdown-icon">&#10067;</span>
                <span data-i18n="nav.faq">FAQ</span>
              </a>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Right: User dropdown or Login -->
      <div class="nav-right">
        <!-- Standalone language toggle â€” always visible -->
        <button class="header-lang-toggle" id="header-lang-toggle" type="button" aria-label="Toggle language">
          <span class="header-lang-option" id="header-lang-fr">FR</span>
          <span class="header-lang-option" id="header-lang-en">EN</span>
          <span class="header-lang-slider" id="header-lang-slider"></span>
        </button>

        <% if (typeof user !== 'undefined' && user) { %>
          <div class="nav-user-dropdown" id="nav-user-dropdown">
            <button class="nav-user-btn" id="nav-user-btn" type="button">
              <div class="nav-avatar-wrapper">
                <img src="https://cdn.discordapp.com/avatars/<%= user.id %>/<%= user.avatar %>.png?size=128" alt="" class="nav-avatar">
                <% if (user.avatar_decoration_data && user.avatar_decoration_data.asset) { %>
                  <img src="https://cdn.discordapp.com/avatar-decoration-presets/<%= user.avatar_decoration_data.asset %>.png?size=160" alt="" class="nav-avatar-decoration">
                <% } %>
              </div>
              <span class="nav-username"><%= user.global_name || user.username %></span>
              <% if (typeof accessLevel !== 'undefined' && accessLevel !== 'public') { %>
                <span class="access-badge access-<%= accessLevel %>"><%= accessLevel === 'owner' ? 'ðŸ‘‘' : accessLevel === 'admin' ? 'ðŸ›¡ï¸' : 'ðŸ‘¤' %></span>
              <% } %>
              <span class="nav-user-chevron">&#9660;</span>
            </button>
            <div class="nav-user-menu" id="nav-user-menu">
              <div class="nav-user-menu-profile">
                <div class="nav-menu-avatar-wrapper">
                  <img src="https://cdn.discordapp.com/avatars/<%= user.id %>/<%= user.avatar %>.png?size=128" alt="" class="nav-menu-avatar">
                  <% if (user.avatar_decoration_data && user.avatar_decoration_data.asset) { %>
                    <img src="https://cdn.discordapp.com/avatar-decoration-presets/<%= user.avatar_decoration_data.asset %>.png?size=240" alt="" class="nav-menu-avatar-decoration">
                  <% } %>
                  <span class="nav-menu-status-dot"></span>
                </div>
                <div class="nav-menu-user-info">
                  <span class="nav-menu-displayname"><%= user.global_name || user.username %></span>
                  <span class="nav-menu-tag">@<%= user.username %></span>
                </div>
              </div>
              <div class="nav-user-menu-sep"></div>
              <a href="/player/<%= user.id %>" class="nav-user-menu-item">
                <span class="nav-user-menu-icon">ðŸ‘¤</span>
                <span data-i18n="nav.profile">Profil</span>
              </a>
              <a href="/" class="nav-user-menu-item">
                <span class="nav-user-menu-icon">&#127968;</span>
                <span data-i18n="nav.dashboard">Dashboard</span>
              </a>

              <div class="nav-user-menu-sep"></div>
              <a href="/auth/logout" class="nav-user-menu-item nav-user-menu-danger">
                <span class="nav-user-menu-icon">&#128682;</span>
                <span data-i18n="nav.logout">DÃ©connexion</span>
              </a>
            </div>
          </div>
        <% } else { %>
          <a href="/auth/discord" class="btn btn-sm btn-discord">
            <svg width="16" height="16" viewBox="0 -28.5 256 256" fill="currentColor"><path d="M216.856 16.597A208.502 208.502 0 00164.042 0c-2.275 4.113-4.933 9.645-6.766 14.046-19.692-2.961-39.203-2.961-58.533 0-1.832-4.4-4.55-9.933-6.846-14.046a207.809 207.809 0 00-52.855 16.638C5.618 67.147-3.443 116.4 1.087 164.956c22.169 16.555 43.653 26.612 64.775 33.193a161.094 161.094 0 0013.96-22.765 136.2 136.2 0 01-21.958-10.632c1.839-1.36 3.637-2.78 5.38-4.252 42.371 19.702 88.344 19.702 130.169 0 1.764 1.472 3.562 2.893 5.38 4.252-6.992 4.2-14.4 7.7-21.998 10.652 3.832 7.533 8.408 14.792 13.981 22.745 21.142-6.58 42.646-16.637 64.815-33.213 5.316-56.288-9.08-105.09-38.056-148.36zM85.474 135.095c-12.645 0-23.015-11.805-23.015-26.18s10.149-26.2 23.015-26.2c12.867 0 23.236 11.823 23.015 26.2.02 14.375-10.148 26.18-23.015 26.18zm85.051 0c-12.645 0-23.014-11.805-23.014-26.18s10.148-26.2 23.014-26.2c12.867 0 23.236 11.823 23.015 26.2 0 14.375-10.148 26.18-23.015 26.18z"/></svg>
            <span data-i18n="nav.login">Login</span>
          </a>
        <% } %>
      </div>

      <button class="nav-toggle" id="nav-toggle" aria-label="Menu" data-i18n-aria-label="nav.aria_menu">&#9776;</button>
    </div>
  </nav>

  <!-- Left Guild Sidebar (Discord-style) â€” only on guild pages -->
  <% if (showGuildSidebar) { %>
  <aside class="guild-sidebar" id="guild-sidebar">
    <div class="guild-sidebar-list" id="sidebar-guilds">
      <% if (typeof userGuilds !== 'undefined' && userGuilds.length > 0) { %>
        <% userGuilds.forEach(function(g) { %>
          <a href="<%= g.botPresent ? '/guild/' + g.id : '/invite/' + g.id %>" class="sidebar-guild<%= !g.botPresent ? ' sidebar-guild-nobot' : '' %><%= (activeGuildId && g.id === activeGuildId) ? ' active' : '' %>" title="<%= g.name %>" data-guild-id="<%= g.id %>">
            <% if (g.icon) { %>
              <img src="<%= g.icon %>" alt="<%= g.name %>" class="sidebar-guild-img<%= !g.botPresent ? ' sidebar-guild-img-dim' : '' %>">
            <% } else { %>
              <span class="sidebar-guild-initial"><%= g.name ? g.name.charAt(0).toUpperCase() : '?' %></span>
            <% } %>
            <% if (!g.botPresent) { %>
              <span class="sidebar-guild-badge">+</span>
            <% } %>
          </a>
        <% }); %>
      <% } else { %>
        <a href="/auth/discord" class="sidebar-guild sidebar-guild-add" title="Login to see your servers" data-i18n-title="nav.title_login_servers">
          <span class="sidebar-guild-initial">+</span>
        </a>
      <% } %>
    </div>
  </aside>
  <% } %>

  <% if (showGuildSidebar && activeGuildId && activeGuild && title !== 'Invite') { %>
  <!-- Secondary Guild Sidebar (management menu) -->
  <aside class="guild-panel" id="guild-panel">
    <div class="guild-panel-header">
      <% if (activeGuild.icon) { %>
        <img src="<%= activeGuild.icon %>" alt="" class="guild-panel-avatar">
      <% } else { %>
        <span class="guild-panel-initial"><%= activeGuild.name ? activeGuild.name.charAt(0).toUpperCase() : '?' %></span>
      <% } %>
      <span class="guild-panel-name"<% if (!activeGuild.name) { %> data-i18n="fb.server"<% } %>><%= activeGuild.name || 'Server' %></span>
      <div class="guild-panel-settings-wrap" id="sidebar-settings-wrap">
        <button class="guild-panel-settings" id="sidebar-settings-btn" type="button" title="Settings" data-i18n-title="nav.title_settings">&#9881;&#65039;</button>
        <div class="guild-panel-settings-popup" id="sidebar-settings-popup">
          <button class="guild-panel-settings-lang" id="sidebar-lang-toggle" type="button">
            <span id="sidebar-lang-flag">&#127760;</span>
            <span data-i18n="nav.language">Langue</span>
          </button>
        </div>
      </div>
    </div>
    <nav class="guild-panel-nav">
      <a href="/guild/<%= activeGuildId %>" class="guild-panel-item<%= guildPage === 'overview' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#127760;</span>
        <span data-i18n="guild.overview">Vue d'ensemble</span>
      </a>
      <a href="/guild/<%= activeGuildId %>/leaderboard" class="guild-panel-item<%= guildPage === 'leaderboard' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#127942;</span>
        <span data-i18n="guild.leaderboard">Classement</span>
      </a>
      <a href="/guild/<%= activeGuildId %>/history" class="guild-panel-item<%= guildPage === 'history' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#128216;</span>
        <span data-i18n="guild.history">Historique</span>
      </a>
      <% if (typeof accessLevel !== 'undefined' && (accessLevel === 'owner' || accessLevel === 'admin')) { %>
      <div class="guild-panel-sep"></div>
      <span class="guild-panel-label" data-i18n="guild.admin_section">Administration</span>
      <a href="/guild/<%= activeGuildId %>/moderation" class="guild-panel-item<%= guildPage === 'moderation' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#128737;&#65039;</span>
        <span data-i18n="nav.moderation">ModÃ©ration</span>
      </a>
      <a href="/guild/<%= activeGuildId %>/rules" class="guild-panel-item<%= guildPage === 'rules' ? ' active' : '' %>">
        <span class="guild-panel-icon">&#9881;&#65039;</span>
        <span data-i18n="guild.rules">RÃ¨gles du jeu</span>
      </a>
      <% } %>
    </nav>
  </aside>
  <% } %>

  <!-- Main content wrapper -->
  <div class="app-main<%= (showGuildSidebar && activeGuildId && activeGuild && title !== 'Invite') ? ' has-guild-panel' : '' %>" id="app-main">
    <main class="main-content">
