<%- include('partials/header') %>

<%
  // â”€â”€ Role data maps â”€â”€
  var roleImageMap = {
    'WEREWOLF': 'loupSimple.webp', 'SEER': 'voyante.webp', 'WITCH': 'sorciere.png',
    'HUNTER': 'chasseur.webp', 'CUPID': 'cupidon.webp', 'PETITE_FILLE': 'petiteFille.webp',
    'VILLAGER': 'villageois.webp', 'IDIOT': 'idiot.webp', 'SALVATEUR': 'salvateur.webp',
    'ANCIEN': 'ancien.webp', 'WHITE_WOLF': 'loupBlanc.webp', 'THIEF': 'voleur.webp'
  };
  var campMap = {
    'WEREWOLF': 'wolves', 'SEER': 'village', 'WITCH': 'village', 'HUNTER': 'village',
    'CUPID': 'village', 'PETITE_FILLE': 'village', 'VILLAGER': 'village', 'IDIOT': 'village',
    'SALVATEUR': 'village', 'ANCIEN': 'village', 'WHITE_WOLF': 'solo', 'THIEF': 'village'
  };
  var roleNameMap = {
    'WEREWOLF': 'Loup-Garou', 'SEER': 'Voyante', 'WITCH': 'Sorci\u00e8re', 'HUNTER': 'Chasseur',
    'CUPID': 'Cupidon', 'PETITE_FILLE': 'Petite Fille', 'VILLAGER': 'Villageois',
    'IDIOT': 'Idiot du Village', 'SALVATEUR': 'Salvateur', 'ANCIEN': 'Ancien',
    'WHITE_WOLF': 'Loup Blanc', 'THIEF': 'Voleur'
  };
  var roleDescMap = {
    'WEREWOLF': 'Chaque nuit, les loups-garous se r\u00e9unissent pour d\u00e9vorer un villageois.',
    'SEER': 'Chaque nuit, la voyante peut d\u00e9couvrir le r\u00f4le d\'un joueur.',
    'WITCH': 'Poss\u00e8de une potion de vie et une potion de mort, utilisable une fois chacune.',
    'HUNTER': 'En mourant, le chasseur peut emporter un autre joueur avec lui.',
    'CUPID': 'D\u00e9signe deux amoureux au d\u00e9but de la partie. Si l\'un meurt, l\'autre aussi.',
    'PETITE_FILLE': 'Peut espionner les loups-garous pendant la nuit, au risque de se faire rep\u00e9rer.',
    'VILLAGER': 'Un simple villageois sans pouvoir sp\u00e9cial. Il doit d\u00e9masquer les loups.',
    'IDIOT': 'S\'il est vot\u00e9 par le village, il est r\u00e9v\u00e9l\u00e9 mais perd son droit de vote.',
    'SALVATEUR': 'Chaque nuit, il prot\u00e8ge un joueur de l\'attaque des loups-garous.',
    'ANCIEN': 'R\u00e9siste \u00e0 la premi\u00e8re attaque des loups-garous gr\u00e2ce \u00e0 sa robustesse.',
    'WHITE_WOLF': 'Joue en solitaire. Chasse avec la meute mais peut d\u00e9vorer un loup une nuit sur deux. Gagne s\u2019il est le dernier.',
    'THIEF': 'D\u00e9couvre 2 cartes au d\u00e9but et peut \u00e9changer son r\u00f4le. Si les deux sont des loups, il doit en prendre une.'
  };

  // Ability phase
  var phaseMap = {
    'WEREWOLF': 'night', 'SEER': 'night', 'WITCH': 'night', 'HUNTER': 'death',
    'CUPID': 'start', 'PETITE_FILLE': 'night', 'VILLAGER': 'day', 'IDIOT': 'day',
    'SALVATEUR': 'night', 'ANCIEN': 'passive', 'WHITE_WOLF': 'night', 'THIEF': 'start'
  };
  var phaseIcons = { 'night': '\uD83C\uDF19', 'day': '\u2600\uFE0F', 'death': '\uD83D\uDC80', 'start': '\uD83C\uDF05', 'passive': '\uD83D\uDEE1\uFE0F' };
  var phaseLabels = { 'night': 'Nuit', 'day': 'Jour', 'death': 'Mort', 'start': 'D\u00e9but', 'passive': 'Passif' };

  var classicRoleIds = ['WEREWOLF', 'VILLAGER', 'SEER', 'WITCH', 'HUNTER'];
  var premiumRoleIds = ['WHITE_WOLF', 'PETITE_FILLE', 'CUPID', 'SALVATEUR', 'ANCIEN', 'IDIOT', 'THIEF'];
  var allRoleIds = classicRoleIds.concat(premiumRoleIds);
  var totalRoles = allRoleIds.length;
  var villageCount = allRoleIds.filter(function(id) { return campMap[id] === 'village'; }).length;
  var wolfCount = allRoleIds.filter(function(id) { return campMap[id] === 'wolves'; }).length;
  var soloCount = allRoleIds.filter(function(id) { return campMap[id] === 'solo'; }).length;
%>

<!-- â•â•â• HERO â•â•â• -->
<section class="rl-hero">
  <div class="rl-hero-bg">
    <div class="rl-hero-gradient"></div>
    <div class="rl-hero-grid"></div>
    <div class="rl-hero-vignette"></div>
  </div>
  <div class="rl-hero-inner">
    <div class="rl-badge">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
      <span data-i18n="roles.badge">Encyclop&eacute;die</span>
    </div>
    <h1 class="rl-hero-title" data-i18n-html="roles.title">D&eacute;couvrez les <span>R&ocirc;les</span></h1>
    <p class="rl-hero-sub" data-i18n="roles.subtitle">Chaque r&ocirc;le poss&egrave;de des pouvoirs uniques. Ma&icirc;trisez-les tous pour dominer la partie.</p>
    <div class="rl-hero-stats">
      <div class="rl-stat">
        <span class="rl-stat-val"><%= totalRoles %></span>
        <span class="rl-stat-label" data-i18n="roles.stat_total">R&ocirc;les</span>
      </div>
      <div class="rl-stat-sep"></div>
      <div class="rl-stat rl-stat--village">
        <span class="rl-stat-val"><%= villageCount %></span>
        <span class="rl-stat-label" data-i18n="roles.stat_village">Village</span>
      </div>
      <div class="rl-stat-sep"></div>
      <div class="rl-stat rl-stat--wolves">
        <span class="rl-stat-val"><%= wolfCount %></span>
        <span class="rl-stat-label" data-i18n="roles.stat_wolves">Loups</span>
      </div>
      <div class="rl-stat-sep"></div>
      <div class="rl-stat rl-stat--solo">
        <span class="rl-stat-val"><%= soloCount %></span>
        <span class="rl-stat-label" data-i18n="roles.stat_solo">Solo</span>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â• TOOLBAR â•â•â• -->
<div class="rl-toolbar">
  <div class="rl-filters" id="rl-filters">
    <button class="rl-filter active" data-camp="all" data-i18n="roles.filter_all">Tous</button>
    <button class="rl-filter" data-camp="village">
      <span class="rl-filter-dot rl-dot-village"></span>
      <span data-i18n="roles.filter_village">Village</span>
    </button>
    <button class="rl-filter" data-camp="wolves">
      <span class="rl-filter-dot rl-dot-wolves"></span>
      <span data-i18n="roles.filter_wolves">Loups</span>
    </button>
    <button class="rl-filter" data-camp="solo">
      <span class="rl-filter-dot rl-dot-solo"></span>
      <span data-i18n="roles.filter_solo">Solo</span>
    </button>
  </div>
  <button class="rl-flip-btn" id="btn-flip-all" type="button">
    <span class="rl-flip-icon">&#127183;</span>
    <span data-i18n="roles.reveal">R&eacute;v&eacute;ler tout</span>
  </button>
</div>

<!-- â•â•â• CLASSIC ROLES â•â•â• -->
<section class="rl-section" id="classic-roles">
  <div class="rl-section-head">
    <div class="rl-section-icon">&#128058;</div>
    <div>
      <h2 class="rl-section-title" data-i18n-html="roles.classic_title">R&ocirc;les <span>Classiques</span></h2>
      <p class="rl-section-desc" data-i18n="roles.classic_desc">Les r&ocirc;les essentiels du jeu de base</p>
    </div>
    <span class="rl-section-count"><%= classicRoleIds.length %> <span data-i18n="roles.roles_label">r&ocirc;les</span></span>
  </div>
  <div class="rl-grid">
    <% classicRoleIds.forEach(function(rid, idx) {
      var r = builtIn.find(function(b) { return b.id === rid; });
      if (!r) return;
      var imgFile = roleImageMap[r.id];
      var camp = campMap[r.id] || 'village';
      var displayName = roleNameMap[r.id] || r.name;
      var desc = roleDescMap[r.id] || '';
      var phase = phaseMap[r.id] || 'passive';
    %>
      <div class="rl-card rl-card--<%= camp %>" data-camp="<%= camp %>" style="--ci:<%= idx %>">
        <div class="rl-card-accent"></div>
        <div class="rl-card-img-wrap">
          <div class="rl-flip">
            <div class="rl-flip-inner">
              <div class="rl-flip-front">
                <img src="/static/img/roles/loup-garou-dos.png" alt="Carte" loading="lazy">
              </div>
              <div class="rl-flip-back">
                <% if (imgFile) { %>
                  <img src="/static/img/roles/<%= imgFile %>" alt="<%= displayName %>" loading="lazy">
                <% } else { %>
                  <span class="rl-card-emoji">&#128058;</span>
                <% } %>
              </div>
            </div>
          </div>
        </div>
        <div class="rl-card-body">
          <h3 class="rl-card-name" data-i18n="role.name.<%= r.id %>"><%= displayName %></h3>
          <div class="rl-card-meta">
            <span class="rl-camp camp-<%= camp %>" data-i18n="role.camp.<%= camp %>"><%= camp === 'wolves' ? 'Loups' : camp === 'solo' ? 'Solo' : 'Village' %></span>
            <span class="rl-phase phase-<%= phase %>" data-i18n="roles.phase_<%= phase %>"><%= phaseIcons[phase] %> <%= phaseLabels[phase] %></span>
          </div>
          <p class="rl-card-desc" data-i18n="role.desc.<%= r.id %>"><%= desc %></p>
        </div>
      </div>
    <% }); %>
  </div>
</section>

<!-- â•â•â• PREMIUM ROLES â•â•â• -->
<section class="rl-section rl-section--premium" id="premium-roles">
  <div class="rl-section-head rl-section-head--premium">
    <div class="rl-section-icon rl-section-icon--premium">&#11088;</div>
    <div>
      <h2 class="rl-section-title rl-section-title--premium" data-i18n-html="roles.premium_title">R&ocirc;les <span>Premium</span></h2>
      <p class="rl-section-desc" data-i18n="roles.premium_desc">Des r&ocirc;les sp&eacute;ciaux aux pouvoirs uniques</p>
    </div>
    <span class="rl-section-count rl-section-count--premium"><%= premiumRoleIds.length %> <span data-i18n="roles.roles_label">r&ocirc;les</span></span>
  </div>
  <div class="rl-grid">
    <% premiumRoleIds.forEach(function(rid, idx) {
      var r = builtIn.find(function(b) { return b.id === rid; });
      if (!r) return;
      var imgFile = roleImageMap[r.id];
      var camp = campMap[r.id] || 'village';
      var displayName = roleNameMap[r.id] || r.name;
      var desc = roleDescMap[r.id] || '';
      var phase = phaseMap[r.id] || 'passive';
    %>
      <div class="rl-card rl-card--premium rl-card--<%= camp %>" data-camp="<%= camp %>" style="--ci:<%= idx %>">
        <div class="rl-card-accent rl-card-accent--premium"></div>
        <div class="rl-card-shimmer"></div>
        <div class="rl-card-img-wrap">
          <div class="rl-flip">
            <div class="rl-flip-inner">
              <div class="rl-flip-front rl-flip-front--premium">
                <img src="/static/img/roles/loup-garou-dos.png" alt="Carte" loading="lazy">
              </div>
              <div class="rl-flip-back">
                <% if (imgFile) { %>
                  <img src="/static/img/roles/<%= imgFile %>" alt="<%= displayName %>" loading="lazy">
                <% } else { %>
                  <span class="rl-card-emoji">&#128058;</span>
                <% } %>
              </div>
            </div>
          </div>
        </div>
        <div class="rl-card-body">
          <h3 class="rl-card-name" data-i18n="role.name.<%= r.id %>"><%= displayName %></h3>
          <div class="rl-card-meta">
            <span class="rl-camp camp-<%= camp %>" data-i18n="role.camp.<%= camp %>"><%= camp === 'wolves' ? 'Loups' : camp === 'solo' ? 'Solo' : 'Village' %></span>
            <span class="rl-phase phase-<%= phase %>" data-i18n="roles.phase_<%= phase %>"><%= phaseIcons[phase] %> <%= phaseLabels[phase] %></span>
          </div>
          <p class="rl-card-desc" data-i18n="role.desc.<%= r.id %>"><%= desc %></p>
        </div>
      </div>
    <% }); %>
  </div>
</section>

<!-- â•â•â• CUSTOM ROLES â•â•â• -->
<section class="rl-section" id="custom-roles">
  <div class="rl-section-head">
    <div class="rl-section-icon">&#127912;</div>
    <div>
      <h2 class="rl-section-title" data-i18n-html="roles.custom">R&ocirc;les <span>Personnalis&eacute;s</span></h2>
      <p class="rl-section-desc" data-i18n="roles.custom_desc">Cr&eacute;&eacute;s par les administrateurs</p>
    </div>
  </div>
  <% if (customRoles.length === 0) { %>
    <div class="rl-empty">
      <span class="rl-empty-icon">&#127912;</span>
      <p data-i18n="roles.no_custom">Aucun r&ocirc;le personnalis&eacute;</p>
      <% if (isAdmin) { %>
        <p class="rl-empty-hint" data-i18n="roles.create_hint">Utilisez le formulaire ci-dessous pour en cr&eacute;er</p>
      <% } else { %>
        <p class="rl-empty-hint" data-i18n="roles.login_hint">Connectez-vous en admin pour cr&eacute;er des r&ocirc;les</p>
      <% } %>
    </div>
  <% } else { %>
    <div class="rl-grid">
      <% customRoles.forEach(function(r) { %>
        <div class="rl-card rl-card--<%= r.camp || 'village' %>" data-camp="<%= r.camp || 'village' %>" data-role-id="<%= r.id %>">
          <div class="rl-card-accent"></div>
          <span class="rl-card-emoji-lg"><%= r.emoji || '&#10067;' %></span>
          <div class="rl-card-body">
            <h3 class="rl-card-name"><%= r.name %></h3>
            <div class="rl-card-meta">
              <span class="rl-camp camp-<%= r.camp %>"><%= r.camp %></span>
              <% if (r.winCondition) { %>
                <span class="rl-phase phase-passive"><%= r.winCondition %></span>
              <% } %>
            </div>
            <% if (r.abilities && r.abilities.length > 0) { %>
              <div class="rl-card-abilities">
                <% r.abilities.forEach(function(ab) { %>
                  <span class="rl-ability-badge" title="<%= ab.type %> &mdash; <%= ab.effect %>">
                    <%= ab.effect %>
                  </span>
                <% }); %>
              </div>
            <% } %>
            <% if (r.description) { %><p class="rl-card-desc"><%= r.description %></p><% } %>
            <% if (isAdmin) { %>
              <div class="rl-card-actions" style="margin-top: 0.75rem; display: flex; gap: 0.5rem;">
                <button class="btn btn-sm btn-danger delete-role" data-role-id="<%= r.id %>" data-guild-id="<%= r.guild_id %>">Supprimer</button>
              </div>
            <% } %>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>

  <% if (isAdmin) { %>
    <!-- â•â•â• ABILITY BUILDER FORM â•â•â• -->
    <div class="rl-create-panel" id="role-builder-panel">
      <h3 class="rl-create-title" data-i18n="roles.create_title">&#128736; Cr&eacute;er un r&ocirc;le</h3>

      <!-- Global validation errors -->
      <div id="role-global-errors" class="role-errors" style="display:none;"></div>

      <form id="create-role-form" class="role-form" novalidate>

        <!-- â”€â”€ Section 1: Basic Info â”€â”€ -->
        <fieldset class="role-fieldset">
          <legend>Informations de base</legend>
          <div class="form-row">
            <div class="form-group">
              <label for="role-name" data-i18n="roles.form_name">Nom</label>
              <input type="text" id="role-name" name="name" required minlength="1" maxlength="50"
                     placeholder="ex. Forgeron" class="form-input" data-i18n-placeholder="roles.form_name_ph">
              <span class="field-error" id="err-name"></span>
            </div>
            <div class="form-group emoji-picker-group">
              <label data-i18n="roles.form_emoji">Emoji</label>
              <div class="emoji-picker-trigger" id="emoji-picker-trigger">
                <span class="emoji-picker-preview" id="emoji-picker-preview">&#10067;</span>
                <span class="emoji-picker-arrow">&#9660;</span>
              </div>
              <input type="hidden" id="role-emoji" name="emoji" value="">
              <div class="emoji-picker-dropdown" id="emoji-picker-dropdown" style="display:none;">
                <div class="emoji-picker-search-wrap">
                  <input type="text" class="emoji-picker-search" id="emoji-picker-search" placeholder="&#128269; Rechercher..." autocomplete="off">
                </div>
                <div class="emoji-picker-cats" id="emoji-picker-cats"></div>
                <div class="emoji-picker-grid" id="emoji-picker-grid"></div>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="role-camp" data-i18n="roles.form_camp">Camp</label>
              <select id="role-camp" name="camp" class="form-select" required>
                <option value="village">Village</option>
                <option value="wolves">Loups</option>
                <option value="solo">Solo</option>
              </select>
              <span class="field-error" id="err-camp"></span>
            </div>
            <div class="form-group">
              <label for="role-win-condition">Condition de victoire</label>
              <select id="role-win-condition" name="winCondition" class="form-select" required>
                <option value="village_wins">Village gagne</option>
                <option value="wolves_win">Loups gagnent</option>
                <option value="solo_survive">Solo &mdash; survivre</option>
                <option value="lovers_survive">Amoureux survivent</option>
              </select>
              <span class="field-error" id="err-winCondition"></span>
            </div>
          </div>
          <div class="form-group">
            <label for="role-description" data-i18n="roles.form_desc">Description</label>
            <textarea id="role-description" name="description"
                      placeholder="D&eacute;crivez les capacit&eacute;s du r&ocirc;le..."
                      class="form-input" rows="2"
                      data-i18n-placeholder="roles.form_desc_ph"></textarea>
          </div>
          <div class="form-group">
            <label for="role-guild-id" data-i18n="roles.form_guild">Serveur</label>
            <select id="role-guild-id" name="guildId" required class="form-select">
              <option value="">-- Choisir un serveur --</option>
              <% (userGuilds || []).filter(function(g) { return g.botPresent; }).forEach(function(g) { %>
                <option value="<%= g.id %>"><%= g.name %></option>
              <% }); %>
            </select>
            <span class="field-error" id="err-guildId"></span>
          </div>
        </fieldset>

        <!-- â”€â”€ Section 2: Strategic Profile â”€â”€ -->
        <fieldset class="role-fieldset strat-profile-fieldset" id="strategic-profile-fieldset">
          <legend>Profil strat&eacute;gique</legend>

          <div class="strat-profile" id="strat-profile">
            <div class="strat-empty" id="strat-empty">
              <p>Ajoutez des r&egrave;gles pour afficher le profil strat&eacute;gique.</p>
            </div>

            <div class="strat-content" id="strat-content" style="display:none;">
              <p class="strat-line" id="strat-power-line">âš¡ Puissance estim&eacute;e : N/A</p>
              <p class="strat-line" id="strat-orient-line">ðŸŽ¯ Orientation : Non d&eacute;fini</p>
              <p class="strat-line" id="strat-risk-line">âš  Risque de stabilit&eacute; : Faible</p>
            </div>
          </div>
        </fieldset>

        <!-- â”€â”€ Section 3: Rules Builder â”€â”€ -->
        <fieldset class="role-fieldset" id="abilities-fieldset">
          <legend>R&egrave;gles du r&ocirc;le <span id="ability-count-badge" class="ability-count-badge">0</span></legend>

          <div class="ab-mode-toggle-wrap">
            <label class="ab-mode-toggle-label">
              <input type="checkbox" id="ab-advanced-toggle" class="ab-mode-toggle-input">
              <span class="ab-mode-toggle-slider"></span>
              <span class="ab-mode-toggle-text">Mode avanc&eacute;</span>
            </label>
            <span class="ab-mode-hint" id="ab-mode-hint">Option secondaire &mdash; &eacute;dition technique du sch&eacute;ma</span>
          </div>

          <div id="abilities-container"></div>

          <div class="abilities-toolbar">
            <button type="button" id="btn-add-ability" class="btn btn-secondary btn-sm">
              Ajouter une r&egrave;gle
            </button>
            <span id="ability-limit-hint" class="ability-limit-hint"></span>
          </div>
        </fieldset>

        <button type="submit" class="btn btn-primary" id="btn-submit-role" data-i18n="roles.create_btn">
          Cr&eacute;er le r&ocirc;le
        </button>
      </form>
    </div>

    <!-- â•â•â• RULE CARD TEMPLATE (hidden) â•â•â• -->
    <template id="ability-card-template">
      <div class="ability-card" data-ability-index="">
        <div class="ability-card-header">
          <button type="button" class="ability-toggle" title="R&eacute;duire/D&eacute;plier">&#9660;</button>
          <span class="ability-card-title">R&egrave;gle #<span class="ability-num">1</span></span>
          <div class="ability-card-actions">
            <button type="button" class="btn-icon ability-duplicate" title="Dupliquer">&#128203;</button>
            <button type="button" class="btn-icon ability-remove" title="Supprimer">&#128465;</button>
          </div>
        </div>
        <div class="ability-card-body">

          <div class="ab-summary" style="display:none;">
            <span class="ab-summary-text"></span>
          </div>

          <div class="ab-simple-mode">
            <div class="ab-rule-divider"></div>

            <div class="ab-step">
              <label class="ab-step-label">Quand cela se produit :</label>
              <select class="form-select ab-when" required>
                <option value="">-- choisir --</option>
                <option value="every_night">Chaque nuit</option>
                <option value="during_day">Pendant le jour</option>
                <option value="on_death">&Agrave; la mort du r&ocirc;le</option>
                <option value="on_targeted">Quand le r&ocirc;le est cibl&eacute;</option>
                <option value="during_vote">Pendant le vote</option>
                <option value="passive">En continu (passif)</option>
              </select>
              <span class="field-error ab-err-when"></span>
            </div>

            <div class="ab-step">
              <label class="ab-step-label">Que se passe-t-il :</label>
              <select class="form-select ab-what" required>
                <option value="">-- choisir --</option>
                <option value="protect">Prot&eacute;ger un joueur</option>
                <option value="kill">&Eacute;liminer un joueur</option>
                <option value="inspect_alignment">R&eacute;v&eacute;ler le camp d'un joueur</option>
                <option value="inspect_role">R&eacute;v&eacute;ler le r&ocirc;le exact d'un joueur</option>
                <option value="redirect">Rediriger une attaque</option>
                <option value="double_vote">Accorder un vote double</option>
                <option value="immune_to_kill">Rendre le r&ocirc;le immunis&eacute; aux attaques</option>
                <option value="win_override">D&eacute;finir une condition de victoire sp&eacute;ciale</option>
                <option value="silence">Emp&ecirc;cher un joueur de parler</option>
                <option value="block">Bloquer la capacit&eacute; d'un joueur</option>
                <option value="reveal_role">R&eacute;v&eacute;ler publiquement le r&ocirc;le</option>
                <option value="reveal_alignment">R&eacute;v&eacute;ler publiquement le camp</option>
                <option value="modify_vote_weight">Modifier le poids du vote</option>
                <option value="swap_roles">&Eacute;changer les r&ocirc;les de deux joueurs</option>
              </select>
              <span class="field-error ab-err-what"></span>
            </div>

            <details class="ab-advanced-params">
              <summary>Param&egrave;tres avanc&eacute;s</summary>
              <div class="ab-advanced-params-body">
                <div class="ab-step">
                  <label class="ab-step-label">Type de cible :</label>
                  <select class="form-select ab-who" required>
                    <option value="">-- choisir --</option>
                    <option value="self">Soi-m&ecirc;me</option>
                    <option value="chosen_player">Un joueur choisi</option>
                    <option value="automatic">Automatique</option>
                    <option value="no_target">Aucune cible</option>
                  </select>
                  <span class="field-error ab-err-who"></span>
                </div>

                <div class="ab-step">
                  <div class="ab-limits-row">
                    <div class="form-group">
                      <label>Limite d'utilisations</label>
                      <div class="ab-charges-wrap">
                        <label class="ab-radio-label">
                          <input type="radio" name="" class="ab-charges-mode" value="infinite" checked> Illimit&eacute;
                        </label>
                        <label class="ab-radio-label">
                          <input type="radio" name="" class="ab-charges-mode" value="limited"> Limit&eacute; &agrave;
                          <input type="number" class="form-input form-input-sm ab-charges-val" min="1" max="99" value="1" disabled>
                          <span>fois</span>
                        </label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label>D&eacute;lai de r&eacute;utilisation</label>
                      <div class="ab-cooldown-wrap">
                        <label class="ab-radio-label">
                          <input type="radio" name="" class="ab-cooldown-mode" value="none" checked> Aucun
                        </label>
                        <label class="ab-radio-label">
                          <input type="radio" name="" class="ab-cooldown-mode" value="has_cooldown"> Tous les
                          <input type="number" class="form-input form-input-sm ab-cooldown-val" min="1" max="10" value="2" disabled>
                          <span>tours</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="ab-parameters ab-step" style="display: none;">
                  <label class="ab-step-label">Options sp&eacute;cifiques</label>
                  <div class="ab-params-fields"></div>
                </div>
              </div>
            </details>
          </div>

          <!-- â•â•â• ADVANCED MODE (raw schema editor) â•â•â• -->
          <div class="ab-advanced-mode" style="display:none;">
            <div class="form-row">
              <div class="form-group">
                <label>Identifiant</label>
                <input type="text" class="form-input ab-id" placeholder="ex. garde_protect" pattern="^[a-z0-9_]+$" maxlength="64">
                <span class="field-error ab-err-id"></span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Type</label>
                <select class="form-select ab-type">
                  <option value="">-- choisir --</option>
                  <option value="night_target">Night Target</option>
                  <option value="passive">Passive</option>
                  <option value="on_death">On Death</option>
                  <option value="on_attacked">On Attacked</option>
                  <option value="on_vote">On Vote</option>
                  <option value="on_phase_start">On Phase Start</option>
                  <option value="on_phase_end">On Phase End</option>
                </select>
                <span class="field-error ab-err-type"></span>
              </div>
              <div class="form-group">
                <label>Trigger</label>
                <select class="form-select ab-trigger">
                  <option value="">-- choisir --</option>
                  <option value="night_action">Night Action</option>
                  <option value="player_targeted">Player Targeted</option>
                  <option value="vote_cast">Vote Cast</option>
                  <option value="player_death">Player Death</option>
                  <option value="phase_start">Phase Start</option>
                  <option value="phase_end">Phase End</option>
                </select>
                <span class="field-error ab-err-trigger"></span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Effet</label>
                <select class="form-select ab-effect">
                  <option value="">-- choisir --</option>
                  <option value="protect">Protect</option>
                  <option value="kill">Kill</option>
                  <option value="inspect_alignment">Inspect Alignment</option>
                  <option value="inspect_role">Inspect Role</option>
                  <option value="double_vote">Double Vote</option>
                  <option value="silence">Silence</option>
                  <option value="redirect">Redirect</option>
                  <option value="block">Block</option>
                  <option value="reveal_role">Reveal Role</option>
                  <option value="reveal_alignment">Reveal Alignment</option>
                  <option value="modify_vote_weight">Modify Vote Weight</option>
                  <option value="swap_roles">Swap Roles</option>
                  <option value="immune_to_kill">Immune to Kill</option>
                  <option value="win_override">Win Override</option>
                </select>
                <span class="field-error ab-err-effect"></span>
              </div>
              <div class="form-group">
                <label>Cible</label>
                <select class="form-select ab-target">
                  <option value="none">Aucune</option>
                  <option value="alive_player">Joueur vivant</option>
                  <option value="alive_other">Joueur vivant (autre)</option>
                  <option value="alive_non_wolf">Non-loup vivant</option>
                  <option value="alive_wolf">Loup vivant</option>
                  <option value="self">Soi-m&ecirc;me</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Phase</label>
                <select class="form-select ab-phase">
                  <option value="">Auto</option>
                  <option value="night">Nuit</option>
                  <option value="day">Jour</option>
                  <option value="any">Toute</option>
                </select>
              </div>
              <div class="form-group" style="max-width: 120px;">
                <label>Charges</label>
                <input type="number" class="form-input ab-charges" min="1" max="99" placeholder="&#8734;">
              </div>
              <div class="form-group" style="max-width: 120px;">
                <label>Cooldown</label>
                <input type="number" class="form-input ab-cooldown" min="1" max="10" placeholder="0">
              </div>
            </div>
            <div class="ab-parameters-adv" style="display:none;">
              <label class="ab-params-label">Param&egrave;tres</label>
              <div class="ab-params-fields-adv"></div>
            </div>
            <span class="field-error ab-err-general"></span>
          </div>

        </div>
      </div>
    </template>
  <% } %>
</section>

<!-- Schema data for JS -->
<script>
  window.__ROLE_SCHEMA__ = <%- typeof schema !== 'undefined' ? schema : '{}' %>;
</script>
<script src="/static/js/strategicEngine.js"></script>
<script src="/static/js/roles.js"></script>
<%- include('partials/footer') %>
