<%- include('partials/header') %>

<%
  // ‚îÄ‚îÄ Derived from roleData (injected via res.locals) ‚îÄ‚îÄ
  var phaseIcons  = { night: '\uD83C\uDF19', day: '\u2600\uFE0F', death: '\uD83D\uDC80', start: '\uD83C\uDF05', passive: '\uD83D\uDEE1\uFE0F' };
  var phaseLabels = { night: 'Nuit', day: 'Jour', death: 'Mort', start: 'D\u00e9but', passive: 'Passif' };
  var campLabels  = { village: 'Village', wolves: 'Loups', solo: 'Solo' };

  var classicRoles = roleData.filter(function(r) { return r.classic; });
  var premiumRoles = roleData.filter(function(r) { return !r.classic; });
%>

<!-- ‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê -->
<section class="rl-hero">
  <div class="rl-hero-bg">
    <div class="rl-hero-gradient"></div>
    <div class="rl-hero-grid"></div>
    <div class="rl-hero-vignette"></div>
  </div>
  <div class="rl-hero-inner">
    <div class="rl-badge">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
      <span data-i18n="roles.badge">Encyclop&eacute;die</span>
    </div>
    <h1 class="rl-hero-title" data-i18n-html="roles.title">D&eacute;couvrez les <span>R&ocirc;les</span></h1>
    <p class="rl-hero-sub" data-i18n="roles.subtitle">Chaque r&ocirc;le poss&egrave;de des pouvoirs uniques. Ma&icirc;trisez-les tous pour dominer la partie.</p>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê TOOLBAR ‚ïê‚ïê‚ïê -->
<div class="rl-toolbar">
  <div class="rl-filters" id="rl-filters">
    <button class="rl-filter active" data-camp="all" data-i18n="roles.filter_all">Tous</button>
    <button class="rl-filter" data-camp="village">
      <span class="rl-filter-dot rl-dot-village"></span>
      <span data-i18n="roles.filter_village">Village</span>
    </button>
    <button class="rl-filter" data-camp="wolves">
      <span class="rl-filter-dot rl-dot-wolves"></span>
      <span data-i18n="roles.filter_wolves">Loups</span>
    </button>
    <button class="rl-filter" data-camp="solo">
      <span class="rl-filter-dot rl-dot-solo"></span>
      <span data-i18n="roles.filter_solo">Solo</span>
    </button>
  </div>
  <button class="rl-flip-btn" id="btn-flip-all" type="button">
    <span class="rl-flip-icon">&#127183;</span>
    <span data-i18n="roles.reveal">R&eacute;v&eacute;ler tout</span>
  </button>
</div>

<!-- ‚ïê‚ïê‚ïê CLASSIC ROLES ‚ïê‚ïê‚ïê -->
<section class="rl-section" id="classic-roles">
  <div class="rl-section-head">
    <div class="rl-section-icon">&#128058;</div>
    <div>
      <h2 class="rl-section-title" data-i18n-html="roles.classic_title">R&ocirc;les <span>Classiques</span></h2>
      <p class="rl-section-desc" data-i18n="roles.classic_desc">Les r&ocirc;les essentiels du jeu de base</p>
    </div>
    <span class="rl-section-count"><%= classicRoles.length %> <span data-i18n="roles.roles_label">r&ocirc;les</span></span>
  </div>
  <div class="rl-grid">
    <% classicRoles.forEach(function(role, idx) { %>
      <div class="rl-card rl-card--<%= role.camp %>" data-camp="<%= role.camp %>" style="--ci:<%= idx %>">
        <div class="rl-card-accent"></div>
        <div class="rl-card-img-wrap">
          <div class="rl-flip">
            <div class="rl-flip-inner">
              <div class="rl-flip-front">
                <img src="/static/img/roles/loup-garou-dos.png" alt="Carte" loading="lazy">
              </div>
              <div class="rl-flip-back">
                <% if (role.image) { %>
                  <img src="/static/img/roles/<%= role.image %>" alt="<%= role.name.fr %>" loading="lazy">
                <% } else { %>
                  <span class="rl-card-emoji">&#128058;</span>
                <% } %>
              </div>
            </div>
          </div>
        </div>
        <div class="rl-card-body">
          <h3 class="rl-card-name" data-i18n="role.name.<%= role.id %>"><%= role.name.fr %></h3>
          <div class="rl-card-meta">
            <span class="rl-camp camp-<%= role.camp %>" data-i18n="role.camp.<%= role.camp %>"><%= campLabels[role.camp] %></span>
            <span class="rl-phase phase-<%= role.phase %>" data-i18n="roles.phase_<%= role.phase %>"><%= phaseIcons[role.phase] %> <%= phaseLabels[role.phase] %></span>
          </div>
          <p class="rl-card-desc" data-i18n="role.desc.<%= role.id %>"><%= role.desc.fr %></p>
        </div>
      </div>
    <% }); %>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê PREMIUM ROLES ‚ïê‚ïê‚ïê -->
<section class="rl-section rl-section--premium" id="premium-roles">
  <div class="rl-section-head rl-section-head--premium">
    <div class="rl-section-icon rl-section-icon--premium">&#11088;</div>
    <div>
      <h2 class="rl-section-title rl-section-title--premium" data-i18n-html="roles.premium_title">R&ocirc;les <span>Premium</span></h2>
      <p class="rl-section-desc" data-i18n="roles.premium_desc">Des r&ocirc;les sp&eacute;ciaux aux pouvoirs uniques</p>
    </div>
    <span class="rl-section-count rl-section-count--premium"><%= premiumRoles.length %> <span data-i18n="roles.roles_label">r&ocirc;les</span></span>
  </div>
  <div class="rl-grid">
    <% premiumRoles.forEach(function(role, idx) { %>
      <div class="rl-card rl-card--premium rl-card--<%= role.camp %>" data-camp="<%= role.camp %>" style="--ci:<%= idx %>">
        <div class="rl-card-accent rl-card-accent--premium"></div>
        <div class="rl-card-shimmer"></div>
        <div class="rl-card-img-wrap">
          <div class="rl-flip">
            <div class="rl-flip-inner">
              <div class="rl-flip-front rl-flip-front--premium">
                <img src="/static/img/roles/loup-garou-dos.png" alt="Carte" loading="lazy">
              </div>
              <div class="rl-flip-back">
                <% if (role.image) { %>
                  <img src="/static/img/roles/<%= role.image %>" alt="<%= role.name.fr %>" loading="lazy">
                <% } else { %>
                  <span class="rl-card-emoji">&#128058;</span>
                <% } %>
              </div>
            </div>
          </div>
        </div>
        <div class="rl-card-body">
          <h3 class="rl-card-name" data-i18n="role.name.<%= role.id %>"><%= role.name.fr %></h3>
          <div class="rl-card-meta">
            <span class="rl-camp camp-<%= role.camp %>" data-i18n="role.camp.<%= role.camp %>"><%= campLabels[role.camp] %></span>
            <span class="rl-phase phase-<%= role.phase %>" data-i18n="roles.phase_<%= role.phase %>"><%= phaseIcons[role.phase] %> <%= phaseLabels[role.phase] %></span>
          </div>
          <p class="rl-card-desc" data-i18n="role.desc.<%= role.id %>"><%= role.desc.fr %></p>
        </div>
      </div>
    <% }); %>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê CUSTOM ROLES ‚ïê‚ïê‚ïê -->
<section class="rl-section" id="custom-roles">
  <div class="rl-section-head">
    <div class="rl-section-icon">&#127912;</div>
    <div>
      <h2 class="rl-section-title" data-i18n-html="roles.custom">R&ocirc;les <span>Personnalis&eacute;s</span></h2>
      <p class="rl-section-desc" data-i18n="roles.custom_desc">Cr&eacute;&eacute;s par les administrateurs</p>
    </div>
  </div>
  <% if (customRoles.length === 0) { %>
    <div class="rl-empty">
      <span class="rl-empty-icon">&#127912;</span>
      <p data-i18n="roles.no_custom">Aucun r&ocirc;le personnalis&eacute;</p>
      <% if (isAdmin) { %>
        <p class="rl-empty-hint" data-i18n="roles.create_hint">Utilisez le formulaire ci-dessous pour en cr&eacute;er</p>
      <% } else { %>
        <p class="rl-empty-hint" data-i18n="roles.login_hint">Connectez-vous en admin pour cr&eacute;er des r&ocirc;les</p>
      <% } %>
    </div>
  <% } else { %>
    <div class="rl-grid">
      <% customRoles.forEach(function(r) { %>
        <div class="rl-card rl-card--<%= r.camp || 'village' %>" data-camp="<%= r.camp || 'village' %>" data-role-id="<%= r.id %>">
          <div class="rl-card-accent"></div>
          <span class="rl-card-emoji-lg"><%= r.emoji || '&#10067;' %></span>
          <div class="rl-card-body">
            <h3 class="rl-card-name"><%= r.name %></h3>
            <div class="rl-card-meta">
              <span class="rl-camp camp-<%= r.camp %>" data-i18n="roles.camp_<%= r.camp %>"><%= r.camp %></span>
              <% if (r.winCondition) { %>
                <span class="rl-phase phase-passive" data-i18n="roles.wc_<%= r.winCondition %>"><%= r.winCondition %></span>
              <% } %>
            </div>
            <% if (r.abilities && r.abilities.length > 0) { %>
              <div class="rl-card-abilities">
                <% r.abilities.forEach(function(ab) { %>
                  <span class="rl-ability-badge" title="<%= ab.type %> &mdash; <%= ab.effect %>">
                    <%= ab.effect %>
                  </span>
                <% }); %>
              </div>
            <% } %>
            <% if (r.description) { %><p class="rl-card-desc"><%= r.description %></p><% } %>
            <% if (isAdmin) { %>
              <div class="rl-card-actions" style="margin-top: 0.5rem; display: flex; gap: 0.35rem; justify-content: center;">
                <button class="btn btn-xs btn-secondary edit-role" data-role-id="<%= r.id %>" data-guild-id="<%= r.guild_id %>">‚úèÔ∏è <span data-i18n="roles.btn_edit">√âditer</span></button>
                <button class="btn btn-xs btn-danger delete-role" data-role-id="<%= r.id %>" data-guild-id="<%= r.guild_id %>">üóë <span data-i18n="roles.btn_delete">Suppr.</span></button>
              </div>
            <% } %>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>

  <% if (isAdmin) { %>
    <!-- ‚ïê‚ïê‚ïê ABILITY BUILDER FORM ‚ïê‚ïê‚ïê -->
    <div class="rl-create-panel" id="role-builder-panel">
      <h3 class="rl-create-title" data-i18n="roles.create_title">&#128736; Cr&eacute;er un r&ocirc;le</h3>

      <!-- Global validation errors -->
      <div id="role-global-errors" class="role-errors" style="display:none;"></div>

      <form id="create-role-form" class="role-form" novalidate>

        <!-- ‚îÄ‚îÄ Section 1: Basic Info ‚îÄ‚îÄ -->
        <fieldset class="role-fieldset">
          <legend data-i18n="roles.legend_basic">Informations de base</legend>
          <div class="form-row">
            <div class="form-group">
              <label for="role-name" data-i18n="roles.form_name">Nom</label>
              <input type="text" id="role-name" name="name" required minlength="1" maxlength="50"
                     placeholder="ex. Forgeron" class="form-input" data-i18n-placeholder="roles.form_name_ph">
              <span class="field-error" id="err-name"></span>
            </div>
            <div class="form-group emoji-picker-group">
              <label data-i18n="roles.form_emoji">Emoji</label>
              <div class="emoji-picker-trigger" id="emoji-picker-trigger">
                <span class="emoji-picker-preview" id="emoji-picker-preview">&#10067;</span>
                <span class="emoji-picker-arrow">&#9660;</span>
              </div>
              <input type="hidden" id="role-emoji" name="emoji" value="">
              <div class="emoji-picker-dropdown" id="emoji-picker-dropdown" style="display:none;">
                <div class="emoji-picker-search-wrap">
                  <input type="text" class="emoji-picker-search" id="emoji-picker-search" placeholder="üîç Rechercher..." data-i18n-placeholder="roles.emoji_search_ph" autocomplete="off">
                </div>
                <div class="emoji-picker-cats" id="emoji-picker-cats"></div>
                <div class="emoji-picker-grid" id="emoji-picker-grid"></div>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="role-camp" data-i18n="roles.form_camp">Camp</label>
              <select id="role-camp" name="camp" class="form-select" required>
                <option value="village" data-i18n="roles.camp_village">Village</option>
                <option value="wolves" data-i18n="roles.camp_wolves">Loups</option>
                <option value="solo" data-i18n="roles.camp_solo">Solo</option>
              </select>
              <span class="field-error" id="err-camp"></span>
            </div>
            <div class="form-group">
              <label for="role-win-condition" data-i18n="roles.form_win_condition">Condition de victoire</label>
              <select id="role-win-condition" name="winCondition" class="form-select" required>
                <option value="village_wins" data-i18n="roles.wc_village_wins">Village gagne</option>
                <option value="wolves_win" data-i18n="roles.wc_wolves_win">Loups gagnent</option>
                <option value="solo_survive" data-i18n="roles.wc_solo_survive">Solo ‚Äî survivre</option>
                <option value="lovers_survive" data-i18n="roles.wc_lovers_survive">Amoureux survivent</option>
              </select>
              <span class="field-error" id="err-winCondition"></span>
            </div>
          </div>
          <div class="form-group">
            <label for="role-description" data-i18n="roles.form_desc">Description</label>
            <textarea id="role-description" name="description"
                      placeholder="D&eacute;crivez les capacit&eacute;s du r&ocirc;le..."
                      class="form-input" rows="2"
                      data-i18n-placeholder="roles.form_desc_ph"></textarea>
          </div>
          <div class="form-group">
            <label for="role-guild-id" data-i18n="roles.form_guild">Serveur</label>
            <select id="role-guild-id" name="guildId" required class="form-select">
              <option value="" data-i18n="roles.choose_server">-- Choisir un serveur --</option>
              <% (userGuilds || []).filter(function(g) { return g.botPresent; }).forEach(function(g) { %>
                <option value="<%= g.id %>"><%= g.name %></option>
              <% }); %>
            </select>
            <span class="field-error" id="err-guildId"></span>
          </div>
        </fieldset>

        <!-- ‚îÄ‚îÄ Section 2: Strategic Profile ‚îÄ‚îÄ -->
        <fieldset class="role-fieldset strat-profile-fieldset" id="strategic-profile-fieldset">
          <legend data-i18n="roles.legend_strategic">Profil strat√©gique</legend>

          <div class="strat-profile" id="strat-profile">
            <div class="strat-empty" id="strat-empty">
              <p data-i18n="roles.strat_empty">Ajoutez des r√®gles pour afficher le profil strat√©gique.</p>
            </div>

            <div class="strat-content" id="strat-content" style="display:none;">
              <p class="strat-line" id="strat-power-line" data-i18n="roles.strat_power">‚ö° Puissance estim√©e : N/A</p>
              <p class="strat-line" id="strat-orient-line" data-i18n="roles.strat_orient">üéØ Orientation : Non d√©fini</p>
              <p class="strat-line" id="strat-risk-line" data-i18n="roles.strat_risk">‚ö† Risque de stabilit√© : Faible</p>
            </div>
          </div>
        </fieldset>

        <!-- ‚îÄ‚îÄ Section 3: Rules Builder ‚îÄ‚îÄ -->
        <fieldset class="role-fieldset" id="abilities-fieldset">
          <legend><span data-i18n="roles.legend_rules">R√®gles du r√¥le</span> <span id="ability-count-badge" class="ability-count-badge">0</span></legend>

          <div class="ab-mode-toggle-wrap">
            <label class="ab-mode-toggle-label">
              <input type="checkbox" id="ab-advanced-toggle" class="ab-mode-toggle-input">
              <span class="ab-mode-toggle-slider"></span>
              <span class="ab-mode-toggle-text" data-i18n="roles.advanced_mode">Mode avanc√©</span>
            </label>
            <span class="ab-mode-hint" id="ab-mode-hint" data-i18n="roles.advanced_hint">Option secondaire ‚Äî √©dition technique du sch√©ma</span>
          </div>

          <div id="abilities-container"></div>

          <div class="abilities-toolbar">
            <button type="button" id="btn-add-ability" class="btn btn-secondary btn-sm" data-i18n="roles.add_rule_btn">
              Ajouter une r&egrave;gle
            </button>
            <span id="ability-limit-hint" class="ability-limit-hint"></span>
          </div>
        </fieldset>

        <button type="submit" class="btn btn-primary" id="btn-submit-role" data-i18n="roles.create_btn">
          Cr&eacute;er le r&ocirc;le
        </button>
      </form>
    </div>

    <!-- ‚ïê‚ïê‚ïê RULE CARD TEMPLATE (hidden) ‚ïê‚ïê‚ïê -->
    <template id="ability-card-template">
      <div class="ability-card" data-ability-index="">
        <div class="ability-card-header">
          <button type="button" class="ability-toggle" title="R√©duire/D√©plier" data-i18n-title="roles.ability_toggle">&#9660;</button>
          <span class="ability-card-title"><span data-i18n="roles.rule_prefix">R√®gle #</span><span class="ability-num">1</span></span>
          <div class="ability-card-actions">
            <button type="button" class="btn-icon ability-duplicate" title="Dupliquer" data-i18n-title="roles.ability_duplicate">&#128203;</button>
            <button type="button" class="btn-icon ability-remove" title="Supprimer" data-i18n-title="roles.ability_remove">&#128465;</button>
          </div>
        </div>
        <div class="ability-card-body">

          <div class="ab-summary" style="display:none;">
            <span class="ab-summary-text"></span>
          </div>

          <div class="ab-simple-mode">
            <div class="ab-rule-divider"></div>

            <div class="ab-step">
              <label class="ab-step-label" data-i18n="roles.when_label">Quand cela se produit :</label>
              <select class="form-select ab-when" required>
                <option value="" data-i18n="roles.opt_choose">-- choisir --</option>
                <option value="every_night" data-i18n="roles.when_every_night">Chaque nuit</option>
                <option value="during_day" data-i18n="roles.when_during_day">Pendant le jour</option>
                <option value="on_death" data-i18n="roles.when_on_death">√Ä la mort du r√¥le</option>
                <option value="on_targeted" data-i18n="roles.when_on_targeted">Quand le r√¥le est cibl√©</option>
                <option value="during_vote" data-i18n="roles.when_during_vote">Pendant le vote</option>
                <option value="passive" data-i18n="roles.when_passive">En continu (passif)</option>
              </select>
              <span class="field-error ab-err-when"></span>
            </div>

            <div class="ab-step">
              <label class="ab-step-label" data-i18n="roles.what_label">Que se passe-t-il :</label>
              <select class="form-select ab-what" required>
                <option value="" data-i18n="roles.opt_choose">-- choisir --</option>
                <option value="protect" data-i18n="roles.what_protect">Prot√©ger un joueur</option>
                <option value="kill" data-i18n="roles.what_kill">√âliminer un joueur</option>
                <option value="inspect_alignment" data-i18n="roles.what_inspect_alignment">R√©v√©ler le camp d'un joueur</option>
                <option value="inspect_role" data-i18n="roles.what_inspect_role">R√©v√©ler le r√¥le exact d'un joueur</option>
                <option value="redirect" data-i18n="roles.what_redirect">Rediriger une attaque</option>
                <option value="double_vote" data-i18n="roles.what_double_vote">Accorder un vote double</option>
                <option value="immune_to_kill" data-i18n="roles.what_immune">Rendre le r√¥le immunis√© aux attaques</option>
                <option value="win_override" data-i18n="roles.what_win_override">D√©finir une condition de victoire sp√©ciale</option>
                <option value="silence" data-i18n="roles.what_silence">Emp√™cher un joueur de parler</option>
                <option value="block" data-i18n="roles.what_block">Bloquer la capacit√© d'un joueur</option>
                <option value="reveal_role" data-i18n="roles.what_reveal_role">R√©v√©ler publiquement le r√¥le</option>
                <option value="reveal_alignment" data-i18n="roles.what_reveal_alignment">R√©v√©ler publiquement le camp</option>
                <option value="modify_vote_weight" data-i18n="roles.what_modify_vote">Modifier le poids du vote</option>
                <option value="swap_roles" data-i18n="roles.what_swap">√âchanger les r√¥les de deux joueurs</option>
              </select>
              <span class="field-error ab-err-what"></span>
            </div>

            <details class="ab-advanced-params">
              <summary data-i18n="roles.advanced_params">Param√®tres avanc√©s</summary>
              <div class="ab-advanced-params-body">
                <div class="ab-step">
                  <label class="ab-step-label" data-i18n="roles.who_label">Type de cible :</label>
                  <select class="form-select ab-who" required>
                    <option value="" data-i18n="roles.opt_choose">-- choisir --</option>
                    <option value="self" data-i18n="roles.who_self">Soi-m√™me</option>
                    <option value="chosen_player" data-i18n="roles.who_chosen">Un joueur choisi</option>
                    <option value="automatic" data-i18n="roles.who_auto">Automatique</option>
                    <option value="no_target" data-i18n="roles.who_none">Aucune cible</option>
                  </select>
                  <span class="field-error ab-err-who"></span>
                </div>

                <div class="ab-step">
                  <div class="ab-limits-row">
                    <div class="form-group">
                      <label data-i18n="roles.usage_limit">Limite d'utilisations</label>
                      <div class="ab-charges-wrap">
                        <label class="ab-radio-label">
                          <input type="radio" name="" class="ab-charges-mode" value="infinite" checked> <span data-i18n="roles.unlimited">Illimit√©</span>
                        </label>
                        <label class="ab-radio-label">
                          <input type="radio" name="" class="ab-charges-mode" value="limited"> <span data-i18n="roles.limited_to">Limit√© √†</span>
                          <input type="number" class="form-input form-input-sm ab-charges-val" min="1" max="99" value="1" disabled>
                          <span data-i18n="roles.times">fois</span>
                        </label>
                      </div>
                    </div>
                    <div class="form-group">
                      <label data-i18n="roles.cooldown_label">D√©lai de r√©utilisation</label>
                      <div class="ab-cooldown-wrap">
                        <label class="ab-radio-label">
                          <input type="radio" name="" class="ab-cooldown-mode" value="none" checked> <span data-i18n="roles.cooldown_none">Aucun</span>
                        </label>
                        <label class="ab-radio-label">
                          <input type="radio" name="" class="ab-cooldown-mode" value="has_cooldown"> <span data-i18n="roles.cooldown_every">Tous les</span>
                          <input type="number" class="form-input form-input-sm ab-cooldown-val" min="1" max="10" value="2" disabled>
                          <span data-i18n="roles.turns">tours</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="ab-parameters ab-step" style="display: none;">
                  <label class="ab-step-label" data-i18n="roles.specific_options">Options sp√©cifiques</label>
                  <div class="ab-params-fields"></div>
                </div>
              </div>
            </details>
          </div>

          <!-- ‚ïê‚ïê‚ïê ADVANCED MODE (raw schema editor) ‚ïê‚ïê‚ïê -->
          <div class="ab-advanced-mode" style="display:none;">
            <div class="form-row">
              <div class="form-group">
                <label data-i18n="roles.adv_id">Identifiant</label>
                <input type="text" class="form-input ab-id" placeholder="ex. garde_protect" data-i18n-placeholder="roles.ability_id_ph" pattern="^[a-z0-9_]+$" maxlength="64">
                <span class="field-error ab-err-id"></span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label data-i18n="roles.adv_type">Type</label>
                <select class="form-select ab-type">
                  <option value="" data-i18n="roles.opt_choose">-- choisir --</option>
                  <option value="night_target" data-i18n="roles.type_night_target">Night Target</option>
                  <option value="passive" data-i18n="roles.type_passive">Passive</option>
                  <option value="on_death" data-i18n="roles.type_on_death">On Death</option>
                  <option value="on_attacked" data-i18n="roles.type_on_attacked">On Attacked</option>
                  <option value="on_vote" data-i18n="roles.type_on_vote">On Vote</option>
                  <option value="on_phase_start" data-i18n="roles.type_on_phase_start">On Phase Start</option>
                  <option value="on_phase_end" data-i18n="roles.type_on_phase_end">On Phase End</option>
                </select>
                <span class="field-error ab-err-type"></span>
              </div>
              <div class="form-group">
                <label data-i18n="roles.adv_trigger">Trigger</label>
                <select class="form-select ab-trigger">
                  <option value="" data-i18n="roles.opt_choose">-- choisir --</option>
                  <option value="night_action" data-i18n="roles.trig_night_action">Night Action</option>
                  <option value="player_targeted" data-i18n="roles.trig_player_targeted">Player Targeted</option>
                  <option value="vote_cast" data-i18n="roles.trig_vote_cast">Vote Cast</option>
                  <option value="player_death" data-i18n="roles.trig_player_death">Player Death</option>
                  <option value="phase_start" data-i18n="roles.trig_phase_start">Phase Start</option>
                  <option value="phase_end" data-i18n="roles.trig_phase_end">Phase End</option>
                </select>
                <span class="field-error ab-err-trigger"></span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label data-i18n="roles.adv_effect">Effet</label>
                <select class="form-select ab-effect">
                  <option value="" data-i18n="roles.opt_choose">-- choisir --</option>
                  <option value="protect" data-i18n="roles.eff_protect">Protect</option>
                  <option value="kill" data-i18n="roles.eff_kill">Kill</option>
                  <option value="inspect_alignment" data-i18n="roles.eff_inspect_alignment">Inspect Alignment</option>
                  <option value="inspect_role" data-i18n="roles.eff_inspect_role">Inspect Role</option>
                  <option value="double_vote" data-i18n="roles.eff_double_vote">Double Vote</option>
                  <option value="silence" data-i18n="roles.eff_silence">Silence</option>
                  <option value="redirect" data-i18n="roles.eff_redirect">Redirect</option>
                  <option value="block" data-i18n="roles.eff_block">Block</option>
                  <option value="reveal_role" data-i18n="roles.eff_reveal_role">Reveal Role</option>
                  <option value="reveal_alignment" data-i18n="roles.eff_reveal_alignment">Reveal Alignment</option>
                  <option value="modify_vote_weight" data-i18n="roles.eff_modify_vote">Modify Vote Weight</option>
                  <option value="swap_roles" data-i18n="roles.eff_swap">Swap Roles</option>
                  <option value="immune_to_kill" data-i18n="roles.eff_immune">Immune to Kill</option>
                  <option value="win_override" data-i18n="roles.eff_win_override">Win Override</option>
                </select>
                <span class="field-error ab-err-effect"></span>
              </div>
              <div class="form-group">
                <label data-i18n="roles.adv_target">Cible</label>
                <select class="form-select ab-target">
                  <option value="none" data-i18n="roles.target_none">Aucune</option>
                  <option value="alive_player" data-i18n="roles.target_alive">Joueur vivant</option>
                  <option value="alive_other" data-i18n="roles.target_alive_other">Joueur vivant (autre)</option>
                  <option value="alive_non_wolf" data-i18n="roles.target_non_wolf">Non-loup vivant</option>
                  <option value="alive_wolf" data-i18n="roles.target_wolf">Loup vivant</option>
                  <option value="self" data-i18n="roles.who_self">Soi-m√™me</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label data-i18n="roles.adv_phase">Phase</label>
                <select class="form-select ab-phase">
                  <option value="" data-i18n="roles.phase_auto">Auto</option>
                  <option value="night" data-i18n="roles.phase_night">Nuit</option>
                  <option value="day" data-i18n="roles.phase_day">Jour</option>
                  <option value="any" data-i18n="roles.phase_any">Toute</option>
                </select>
              </div>
              <div class="form-group" style="max-width: 120px;">
                <label data-i18n="roles.adv_charges">Charges</label>
                <input type="number" class="form-input ab-charges" min="1" max="99" placeholder="&#8734;">
              </div>
              <div class="form-group" style="max-width: 120px;">
                <label data-i18n="roles.adv_cooldown">Cooldown</label>
                <input type="number" class="form-input ab-cooldown" min="1" max="10" placeholder="0">
              </div>
            </div>
            <div class="ab-parameters-adv" style="display:none;">
              <label class="ab-params-label" data-i18n="roles.adv_params">Param√®tres</label>
              <div class="ab-params-fields-adv"></div>
            </div>
            <span class="field-error ab-err-general"></span>
          </div>

        </div>
      </div>
    </template>
  <% } %>
</section>

<!-- Schema data for JS -->
<script>
  window.__ROLE_SCHEMA__ = <%- typeof schema !== 'undefined' ? schema : '{}' %>;
</script>
<script src="/static/js/strategicEngine.js"></script>
<script src="/static/js/roles.js"></script>
<%- include('partials/footer') %>
